---
title             : "The Development of Color Terms in Shipibo-Konibo Children"
shorttitle        : "Color Terms in Shipibo-Konibo Children"

author: 
  - name          : "Martin Fortier\\*"
    affiliation   : "1"
  - name          : "Danielle Kellier\\*"
    affiliation   : "2"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "danielle.kellier@pennmedicine.upenn.edu"
  - name          : "María Fernández Flecha"
    affiliation   : "3"
  - name          : "Michael C. Frank"
    affiliation   : "4"

affiliation:
  - id            : "1"
    institution   : "PSL Research University"
  - id            : "2"
    institution   : "University of Pennsylvania"
  - id            : "3"
    institution   : "Pontificia Universidad Católica del Perú"
  - id            : "4"
    institution   : "Stanford University"

author_note: |
  \* these authors contributed equally. 
  
  This paper is dedicated to the memory of Martin Fortier. MCF was supported by a Jacobs Foundation Fellowship. We are especially grateful to Paul Kay for assistance throughout the study.

abstract: |
  Color word learning is an important case study for the relation between language and perception. While English color word learning is well-documented, there is relatively limited evidence on the developmental trajectory for color words, especially in languages from non-industrialized populations. We study color words and their acquisition in the Shipibo-Konibo (SK), an indigenous group in the Peruvian Amazon. In Study 1, we measure the color vocabulary in SK, updating data from the World Color Survey. We then study receptive and productive knowledge of color words in children, testing in both SK (Study 2) and Spanish (Study 3). Children learning the SK system show a protracted developmental trajectory compared with modern studies of English. Further, when children lack precise color term knowledge, they appeared to follow different strategies for SK and Spanish, using Spanish vocabulary in SK and overgeneralizing in Spanish. For both children and adults, bilingual vocabulary is used adaptively to facilitate task performance, broadly supporting communicative views of color vocabulary.

  
keywords          : "Shipibo-Konibo; Color; Word learning; Bilingualism"
wordcount         : "9258"

bibliography      : ["r-references.bib"]
csl               : "apa.csl"

figsintext        : yes
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes
mask              : no

always_allow_html : yes
class             : "apa7"
output: 
  papaja::apa6_pdf: 
    latex_engine: xelatex
  papaja::apa6_word: default
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_format = "all") })
---

```{r load-packages, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, warning = FALSE, error = FALSE, 
                      message = FALSE, sanitize = TRUE, fig.width = 7)

# note, we need a dev version of papaja!
# remotes::install_github("crsh/papaja@devel")
library("papaja")

library(tidyverse)
library(DT)
library(ggthemes)
library(cowplot)
library(viridis)
library(english)
library(lme4)
library(nnet)
library(here)
library(pander)
library(readxl)
library(colorspace)
library(forcats)
library(stringi)
```

```{r analysis-preferences}
source(here("helpers/load_and_process.R"))

set.seed(42) # Seed for random number generation

theme_set(theme_bw() + 
            theme(strip.background = element_blank(), 
                  panel.grid = element_blank())) # nice theme with limited extras

raw_data <- feather::read_feather(here("intermediates/processed_data.csv"))

```


# Introduction

Color is where language and perception meet. Words such as "blue" and "red" draw boundary lines across a perceptually continuous space of hues. In English, there are 11 high frequency color terms that together span hue space, but this color categorization is not universal. For instance, Russian speakers use two distinct words to describe the colors light blue ("goluboy") and dark blue ("siniy"); and some languages have as few as two words [e.g., the Jalé people only have terms for "light" and "dark"; @berlin1969]. Why do languages vary in their color systems? One emerging consensus is that languages categorize the color spectrum in different ways in part due to functional demands [@gibson2017]: both smaller and larger color systems are relatively optimal for different communicative needs [@regier2007; @zaslavsky2018]. 

Learnability is hypothesized to be one contributor to this cross-linguistic diversity [@chater2010; @culbertson2012]. Some color systems may be easier to learn for children than others, or children may show inductive biases that shape color vocabulary. But the actual acquisition of color terms -- while relatively well-studied in English [e.g., @sandhofer1999; @wagner2013] -- is extremely under-studied across other populations. Berlin & Kay’s seminal World Color Survey [WCS; @berlin2009] presented adult speakers of over 100 languages with differently colored chips and asked them to produce a label, characterizing the space of color vocabulary in a range of written and unwritten languages. The WCS is an invaluable resource for the cross-linguistic study of color vocabulary, but no comparable resource exists for cross-cultural studies of how this vocabulary is learned across childhood. 

In the current project, our goals were (1) to characterize color term knowledge in an indigenous population previously studied by the WCS, the Shipibo-Konibo (SK), and then (2) to build on this foundation to characterize the developmental trajectory of color language acquisition in a group of children raised learning Shipibo-Konibo, outside of the WEIRD (Western Educated Industrialized Rich Democratic) populations that are over-represented in behavioral science [@henrich2010; @nielson2017]. In the remainder of the introduction, we  review color vocabulary development in children, and then we turn to what is currently known about color terms in Latin American varieties of Spanish, such as Mexican, Colombian, and Bolivian Spanish, and in some Amazonian languages, such as Candoshi, Pirahã, and Shipibo Konibo. These two literatures set the stage for our own study.

## The Development of Color Vocabulary

To adults, colors are extremely salient attributes of the perceptual world; even when color is seemingly task-irrelevant, we mention it [e.g., @sedivy2003]. It is quite surprising then that children sometimes struggle to master color vocabulary. Early observations by Darwin, Bateman, Nagel, and others attest to individual children’s delays in the correct use of color terms well into middle childhood; several diarists report 5 -- 8 year olds with limited mastery of basic level color terms [reviewed in @bornstein1985]. These observations are surprising in light of the body of infant research that suggests that infants’ color discrimination abilities are relatively well-developed by the end of the first year of life [for review see e.g., @dobson1978]. 

Indeed, the age at which color words are learned has been shifting over the past hundred years, at least for English-speaking children. @bornstein1985 documents substantial decreases in the age at which many children master their colors, citing four years as an age at which most children are proficient. In fact, this age may have even decreased further in the last thirty years, judging from recent studies [@wagner2013; @wagner2018]. What makes color words hard to learn, and why are they getting easier? 

One prominent account of what makes color word learning difficult is that children may not recognize that color words pick out the perceptual dimension of hue at all [@bartlett1977; @sandhofer1999], and that once they do they then rapidly map colors correctly onto the appropriate range of hues in color space. This account nicely explains the observation that there is often a period during which children will produce an inappropriate color word when asked "what color is this?" -- they know that color words go together and answer a particular question, they just don’t know which color is which. A further point of parsimony for this account is that infants’ color boundaries are not all that different in their placement from those of adults; thus, presumably the mapping task they face -- from words to hues -- is not all that difficult, once they recognize the dimension that they are attempting to map [@bornstein1976; @franklin2005]. 

On the other hand, when children’s mapping errors are examined in detail, they show more systematicity than would be predicted by this account. In particular, @wagner2013 show that children who have not yet fully mastered the color lexicon nevertheless use colors in ways that are more consistent with overextension than with ignorance of the dimensional mapping -- for example, using "blue" to refer to *blue* and *green* hues (which are close together in color space). These overextensions are reminiscent of noun overextensions   that have been documented in early word learning, for example calling a horse "dog"  [@clark1973]. Further, the order of acquisition for color word meanings in @wagner2013 was well-predicted by the frequency and perceptual salience of color categories [@yurovsky2015], supporting the view that color categories are learned gradually from perceptual experiences rather than all at once. Finally, both behavioral and eye-tracking evidence suggests that children show earlier comprehension than production for color words, a phenomenon seen throughout early word learning [@sandhofer1999; @wagner2018]. In eye-tracking tasks, comprehension also shows evidence of perceptual overextensions, such that children fixate perceptually close distractor colors more than far distractors [@wagner2018]. In sum, although attention to the dimension of hue may be one difficult component of color word learning,  systematic mapping of words to particular regions of perceptual space is likely another.

Why is color learning occurring earlier in development, at least for English-learning children [@bornstein1985]? There are at least two obvious, plausible reasons. The first is the increasing prevalence of manufactured toys for children that vary exclusively in color (e.g., sets of plastic blocks of different colors) [@gibson2017]. Such objects provide perfect contrastive input for mapping: if one is called "blue" and the other is not, such input implicates pragmatically that "blue" is an informative term [@frank2014; @clark1987]. The second is a cultural landscape for parents and early educators that presupposes color words are an important part of early childhood education practices, and as such should be taught explicitly (perhaps using toys specifically made for this purpose). 

In the current paper, we ask about the trajectory of color word learning in an environment where both of these factors are less prevalent: that is, manufactured toys are less frequent, and parents are (at least anecdotally) far less motivated to provide color labels to their children. Here we are inspired by the work of @piantadosi2014, who studied the learning of number word meanings in children in an Amazonian culture. They found that, despite differences in developmental timing, the patterns of generalization of number meaning were generally similar to those documented in WEIRD populations. We are interested in whether we observe similar dynamics in color word learning. In the next section, we turn to the question of adults' color vocabulary in Spanish and Amazonian language, setting the stage for our studies of acquisition. 

## Color in Latin American varieties of Spanish and Amazonian languages 

In their seminal work, @berlin1969 established a framework for cross-linguistic differences in color vocabulary. They focused their work on basic level color terms (BCTs), the words that are highest-frequency and most consistently used when speakers of a language refer to visual hue. According to these authors, there is a fixed evolutionary sequence of stages that languages go through as they increase their color vocabulary; in this sense, if a language encodes a category from a particular stage, it must also encode those corresponding to all previous stages. So, for example, a Stage II system would add the term "red" to the colors already present in Stage I ("black" and "white"). It wouldn't be possible for a system to have "red" if it doesn't already have "black" and "white". 

Although the original @berlin1969 framework has been revised and questioned in subsequent work [e.g., @levinson2000], it continues to shape the research landscape on color. Yet there has been significant controversy about the applicability of the framework to Amazonian languages, specifically centered around the status of ad hoc color terms. Ad hoc terms are  descriptors of objects or properties that are adopted for the description of hue (e.g., the use of terms like "blood" or "bloody" to refer to red objects). Such ad hoc terms are a common way that languages supplement color vocabulary [e.g., @kristol1980], with historical case studies suggesting that they can often become conventionalized BCTs [e.g., the English color "orange" derives from an ad hoc term based on the fruit; @stclair2016]. As we will review below, the Berlin and Kay framework appears to apply relatively well to Spanish dialects, although some ad hoc terms are sometimes attested. In contrast, in Amazonian languages, ad hoc terms are more common and may make up a large proportion of the color language being used.

Only a handful of studies have explored the use of color terms in the varieties of Spanish in Latin America. @berlin1969 examine the case of the Mexican dialect of Spanish, which they consider to be in Stage VII of their classification (color systems in this stage, the most advanced one, consist of between 8 and 11 color terms). They identify the following BCTs in Mexican Spanish: "blanco" (white), "negro" (black), "rojo" (red), "verde" (green), "amarillo" (yellow), "azul" (blue), "café" (brown or coffee-colored), "morado" (purple), "rosa" (pink or rose), "anaranjado" (orange, strictly referring to the color) and "gris" (gray). @monroy1989 offered some further information on Colombian Spanish based on materials collected for the Linguistic-ethnographic Atlas of Colombia, presenting some examples of ad hoc color terms referring to colors through objects prototypically instantiating these colors (e.g., vegetables, animals, food, metals, precious stones, fire and its derivatives, and atmospheric phenomena). 

More recent work on Spanish largely confirms the WCS classification, while adding some dialectal nuance. @aragon2016 offers an ethnolinguistic study of color terms in Mexican Spanish: she analyzes the elaboration of these meanings in dictionaries, as well as the references and associations that informants resort to for their own definitions. Aragón concludes that the local natural and cultural referents constitute a point of consensus among Mexicans when defining terms of color, even though these colors still follow the general schema of BCTs. @lillo2018 generally confirm these observations, finding an additional BCT in Uruguayan Spanish, "celeste" (sky blue), which we also observe in our study. This observation is also confirmed by @gibson2017 for Bolivian Spanish, who document 11 modal color names including "celeste" but not "gris" (gray). 

Turning now to Amazonian languages, SK color terms were studied in the original WCS. In this original data collection effort, they list 21 distinct terms (though this could categorized as 20 as "huiso" and "wiso" are alternative spellings).  seem like alternate spellings). As their protocol has the field experimenters ask only for BCTs, it is assumed that all recorded terms are basic, but only six terms appear in >5% of WCS trials; 10 terms appear in <1% of trials (see Figure \@ref(fig:study1-figure)A for a representation of this data). Immediately the issue of ad hoc terms rears its head [@levinson2000].^[In fact, a greater diversity of color terms beyond the basic level is used in the data for the majority of WCS languages [@gibson2017, Figure S1], suggesting that the effort to elicit only BCTs in WCS was not successful.] It is worth mentioning that two anthropological studies [@morin1973; @tournon2002] have also investigated the color terms used in this Amazonian language. However, these two studies contain some serious methodological pitfalls: a very limited number of color chips were tested with only a few participants. As a result, we will not further discuss these studies in the remainder of this article and will only focus in our study on a comparison with the WCS data.

To our knowledge, relatively little work has looked at effects of bilingualism in this space. But based on their work with Tzeltal participants (both Tzeltal monolinguals as well as Tzeltal-Spanish bilinguals), @berlin1969 report that bilingualism did not skew their results regarding the existence of semantic universals in the domain of color vocabulary. Tzeltal has five BCTs:  "?ihk´" (black), "sak" (white), "cah" (red), "yaš" (green) and "k´an" (yellow). This language is estimated to be transitioning from Stage IV to V, which is reflected in the ambiguity of the focus of "yaš" (grue, a category covering English green and blue hues). While all Tzeltal speakers acknowledge that "yaš" includes two major perceptual centers ("green" and "blue"), they vary in terms of their favored focal (either in the "green" or "blue" area). The authors posit that a long history of contact with Spanish has probably accentuated this pattern, and suggest that exposure to Spanish in schools will eventually cause "yaš" to be entirely restricted to greens, and "azul" (or some other Spanish term) will be adopted into the Tzeltal color system.

Several other indigenous Amazonian color systems were studied in the WCS. One of them, Candoshi, has been further examined by @surralles2016. Contrary to the WCS, Surrallés argues that no proper color terms exist in this language. If the fieldworkers of the WCS found otherwise, he claims, it is only because they misidentified the elicited terms as BCTs when they are nothing more than a series of ad hoc terms referring to objects or animals of the surrounding environment. For example, in Candoshi, the word for yellow is "ptsiyaromashi" ("like the feathers of a milvago bird"), the word for red is "chobiapi" ("ripe fruit"), the word for green is "kamachpa" ("unripe fruit"), etc. These findings lead Surrallés to argue that the Candoshi do not have a proper color system. When they use "color terms" they are not trying to subsume objects of the world under abstract color categories, but they are rather establishing horizontal and ad hoc comparisons between similar objects of the world.

A similar criticism of the WCS approach was given by @everett2005 based on his study of Pirahã, another Amazonian language. Everett also rejected the idea that there are BCTs, arguing that the four color terms identified as basic in the WCS are not such. For example, the word identified as the BCT for *red*/*yellow* in Pirahã ("bi i sai") was argued to be simply a property descriptor meaning "blood-like". The argument here is that Pirahã color terms might be ad hoc comparisons rather than proper basic terms, though there was no quantitative evaluation of this claim such as analysis of the variability in term use. 

Finally, @gibson2017 compare their Bolivian Spanish data with Tsimane, a language of the Amazonian piedmont. Out of a total of 80 color chips, Tsimane exhibited 8 modal or basic color terms. However, in their free-choice paradigm, Tsimane speakers showed greater variability in  nearly all the color terms used for all color chips presented in their study. Thus, Tsimane speakers appear to show substantial ad hoc term usage. 

In sum, while some dialectical differences can be noticed across varieties of Spanish, these slight variations are consistent with the general framework proposed by the WCS. Also consistent with the WCS, Amazonian color systems are characterized by fewer BCTs than the Spanish dialect systems. There is less consistency in the finding that ad hoc terms appear to play a central role in Amazonian color systems -- and possibly also in some South American Spanish dialects (such as Colombian Spanish). 

## The Current Study

The Shipibo-Konibo people are an indigenous group located within the Peruvian Amazon. They are mainly horticulturalists, fishermen, occasionally hunters but are noted for their strong display of tradition despite increasingly regular interactions with the western world. They are also skilled traditional artists or artisans, resorting to these activities as a way to earn an income for their household. Their children receive formal schooling for 4 hours a day, both in SK^[The phonemic inventory of SK language has 4 vowels (/i/, /ɨ/, /a/ and /o/) and 15 consonants: 3 plosives (/p/, /t/ and /k/), 2 affricates (/ts/ and /ʧ/), 2 nasals (/m/ and /n/), 5 fricatives (/β/, /s/, /ʃ/, /ʂ/, /ɦ/), and 3 approximants (/w/, /ɻ/ and /j/).] and Spanish. The amount of Spanish input they receive at school increases towards adolescence when they enter secondary education. There can be variation in how both languages coexist in the school setting from one village to another. Most SK adults are considered SK-Spanish bilinguals to different degrees although the elders may have only a minor grasp on Spanish.

The SK indigenous people are particularly interesting for at least two reasons: they differ from samples usually studied by cross-cultural evolutionary psychologists [@apicella2016]. Indeed, evolutionary psychologists are particularly interested in the study of contemporary hunter-gatherers because they are believed to be a good model of our Pleistocene ancestors. By contrast, like most riverine Amazonian cultures, the SK culture is not based on hunting and gathering, but on horticulture, fishing, and to a limited extent, hunting.

Further, because of their location on the Ucayali River, one of the main tributaries of the Amazon, the SK culture has always been enmeshed in rich trading networks involving other indigenous groups of the Andes and the Lowlands (in pre-conquest times) as well as Mestizos and Westerners (in post-conquest times) [@lathrap1970]. It would thus be mistaken to think of this culture as an "isolated" or "preserved" one. On the contrary, having been extensively exposed to numerous cultural influences, the SK culture has been constantly reworked and reshaped through the centuries. The first deep transformation in Shipibo-Konibo culture can be traced to the XVIII century, when Shipibos, Konibos and Shetebos were forced to live together by Franciscan evangelization [@Myers1974]. Later, the second half of the 20th century was characterized by intense contact with the Spanish-speaking Mestizo populations established along the Ucayali River. As a result, today’s SK culture straddles two worlds. 

In Study 1, we examine the color vocabulary of current SK adults, comparing their vocabulary to results from the World Color Survey (a gap of more than 50 years). Next, we examine SK children’s color vocabulary, focusing on their knowledge and their generalization of color terms across both SK (Study 2) and Spanish (Study 3). Through these three studies, we attempted to answer four primary research questions:

1. What is the color vocabulary of SK and how has it changed since the WCS data collection effort?
2. What is the developmental timeline of color term acquisition in a non-WEIRD population that has fewer industrial products (toys) and less early childhood education?
3. Is the developmental course -- especially with respect to generalization and the dynamics of comprehension and production -- similar to that which has been documented in studies of English color learning? 
4. How is color term learning development affected by bilingual exposure?

To presage our conclusions, we find that SK color vocabulary has remained relatively consistent, with the exception of some intrusions from Spanish in areas of low coverage by the SK color system. Children learning the SK system show a protracted developmental trajectory compared with modern descriptive studies in WEIRD contexts. Further, when children lack precise color term knowledge, they appeared to follow different strategies for SK and Spanish: for SK, children fell back on Spanish knowledge, while for Spanish, we observed substantial over-generalization of terms [@wagner2013; @wagner2018]. Finally, we find that children draw on their Spanish knowledge especially for colors where there is high uncertainty among adult speakers, suggesting that they are adaptively using their bilingual knowledge to facilitate accurate naming. 

# Study 1

Before we could assess the developmental trajectory of color term knowledge in SK children, our goal was to replicate and update the characterization of the adult SK color system given by the World Color Survey. As the WCS study took place generations prior, we could not assume the SK color term mappings had remained static especially through years of industrialization and exposure to the Spanish language and its own color term system. As such, Study 1 used a modified version of the original WCS protocol, with an identical color chip set (subsampled to decrease task length). The goals were to characterize the current SK vocabulary and to generate a standard of adult knowledge against which subsequent child participants could be scored.


```{r study1-participants}
study1_participants <- read_csv(here("data/Current_Data/naming_colors_participants.csv")) %>%
  mutate(age = as.numeric(as.character(edad)),
         `edad aprendizaje del espanol` = as.numeric(as.character(`edad aprendizaje del espanol`)))

study1_occupations <- study1_participants %>%
  group_by(género, ocupación) %>%
  summarise (n = n(), .groups = "drop") %>%
  group_by(género) %>%
  mutate(freq_gender = 100*n / sum(n)) %>%
  ungroup() %>%
  mutate(freq_total = 100*n / sum(n))

study1_agespanish_test <- cor.test(~ `edad aprendizaje del espanol` + age, data = study1_participants)

```

## Methods 

### Participants

Our protocol for Study 1 and all subsequent studies received ethical approval from Pontificia Universidad Católica del Perú’s Institutional Review Board. We recruited `r pull(summarise(study1_participants, n(), .groups = 'drop'))` adult participants (`r pull(summarise(study1_participants, sum(género == 'masculino'), .groups = 'drop'))` men). We experienced difficulty recruiting male participants as many of the men were away from the village during the day, resulting in a sample that is predominantly female. Most participants (31, 4 men) were from SK villages of the Middle Ucayali region (Yarinacocha, San Francisco, and Nueva Betania), with a subset from communities of the Lower (Paoyhan) and Upper (Puerto Belén) Ucayali region. Within the small town of Yarinacocha (in the vicinity of Pucallpa), we recruited participants (9, 2 men) from Bena Jema, a predominantly SK neighborhood. All the other recruitment sites were native community villages with exclusively SK residents but a strong relation with the outside world. Overall, the sample included SK adults who could be characterized as more urban (Yarinacocha and San Francisco sites) or more traditional and in regular contact with the surrounding rainforest (Nueva Betania, Paoyhan, and Puerto Belén sites).

The median age for participants was `r median(study1_participants$age, na.rm = T)` years (*IQR* = `r paste0(round(quantile(study1_participants$age, probs = c(0.25, 0.75), na.rm = T)), collapse = "-")`) ranging from `r min(study1_participants$age, na.rm = T)` to `r max(study1_participants$age, na.rm = T)` years. Regarding occupations, `r round(filter(study1_occupations, género == 'femenino' & ocupación == 'ama de casa')$freq_gender)`% of the `r pull(summarise(study1_participants, sum(género == 'femenino'), .groups = 'drop'))` female participants were homemakers or housewives (`r round(filter(study1_occupations, género == 'femenino' & ocupación == 'ama de casa')$freq_total)`% of the overall sample) and another `r round(filter(study1_occupations, género == 'femenino' & ocupación == 'artesana')$freq_gender)`% were artisans (`r round(filter(study1_occupations, género == 'femenino' & ocupación == 'artesana')$freq_total)`%). `r Words(filter(study1_occupations, género == 'masculino' & ocupación == 'agricultor')$n)` of the `r pull(summarise(study1_participants, sum(género == 'masculino'), .groups = 'drop'))` male participants (`r round(filter(study1_occupations, género == 'masculino' & ocupación == 'agricultor')$freq_gender)`%, `r round(filter(study1_occupations, género == 'masculino' & ocupación == 'agricultor')$freq_total)`% overall) were horticulturalists. Across both sexes, `r sum(filter(study1_occupations, género == 'femenino' & grepl('estud', ocupación))$n)` women (`r round(sum(filter(study1_occupations, género == 'femenino' & grepl('estud', ocupación))$freq_gender))`%, `r round(sum(filter(study1_occupations, género == 'femenino' & grepl('estud', ocupación))$freq_total))`% overall) and `r filter(study1_occupations, género == 'masculino' & grepl('estud', ocupación))$n` men (`r round(filter(study1_occupations, género == 'masculino' & grepl('estud', ocupación))$freq_gender)`%, `r round(filter(study1_occupations, género == 'masculino' & grepl('estud', ocupación))$freq_total)`% overall) identified as students, comprising a total of `r round(sum(filter(study1_occupations, grepl('estud', ocupación))$freq_total))`% of the population. Although all adult participants were required to be native SK speakers, all were introduced to the Spanish language prior to adolescence (median age = `r median(study1_participants$'edad aprendizaje del espanol', na.rm = T)`yo, *IQR* = `r paste0(quantile(study1_participants$'edad aprendizaje del espanol', c(0.25, 0.75), na.rm = T), collapse = "-")`).

### Materials and procedure

Similar to the original WCS, we used a set of 330 Munsell color chips and asked participants to name them [@berlin1969]. We made a number of changes to the procedure, however. In the WCS, every participant provided terms for all 330 chips. Due to fear of participant fatigue, we split up color chips based on their ID numbers (even or odd) and participants were randomly assigned to work with either even- or odd-numbered color chips. As a result, each participant was presented with only 165 chips. All 330 hues within the set are visualized in Appendix 1. Dimensions of the chips were 2 cm × 2.5 cm. 

First, the experimenter explained the general procedure and goals of the study to the participant. The experimenter would then present a single color chip to the participant and ask in SK: "What is the color of this chip?" The study was conducted solely in SK language with the assistance of a bilingual SK- and Spanish-speaking research assistant. It should be noted that although the experiment was conducted in SK, the SK word for color used is identical to the Spanish word *color* (an example of SK speakers adopting Spanish words into their lexicon), which might have encouraged Spanish language use.

Besides the reduction in set size, our procedure also differed from that of WCS [see @berlin2009, pp. 585--591] in other aspects. Participants sat in front of the experimenter. To manage changes in natural light intensity between participants, the experiment took place indoors near a window or a door instead of outdoors. Another difference between our study and the WCS procedure is in our approach for encouraging participants to describe chips using BCTs. In the WCS, the experimenter would instruct participants to only provide BCTs during the task (e.g., describing a chip as "blue" as opposed to "navy blue" or "sky-like"). However, we had difficulties concisely explaining the concept of a BCT compared to other terms.^[Indeed, as @berlin2009 [pp. 587--589] acknowledge, there is no straightforward necessary and sufficient criteria for the basicness of a color term [cf @levinson2000].] We decided to allow participants to describe a chip with any term they wished, and to ask further questions to elicit a BCT when they did not do so on their first try. For example, when presented with a red color chip, the participant might use the term "blood-like" (a non-BCT). The experimenter would then ask: "Do you know of any other word to refer to the color of this chip?". Should the participant subsequently respond with "dark red" (another non-BCT), the experimenter would further ask: "How would you refer to this color with only one word?" Eventually, the participant might use the term "red" (a BCT). For some chips, participants provided a BCT as their first description. For others, a BCT might be preceded by 1 or 2 non-BCTs. When participants failed to provide a BCT after 3 attempts (i.e., two follow-up questions), no further questions were asked, and the experimenter moved on to the next chip. All responses, BCT or not, were recorded in the order produced by the participant. 

## Results and Discussion

```{r study1-profusion}

study1_profusion <- naming_data %>%
  group_by(subj, color_cat, nature) %>%
  summarise(n = n(), .groups = 'drop') %>%
  group_by(color_cat, nature) %>%
  spread(subj, n, fill = 0) %>%
  gather(key = 'subj', value = 'n', -color_cat, -nature) %>%
  mutate(prop = 100*n/165) %>%
  summarise(`% of Subjects Who Used the Term (Current)` = round(100*sum(prop > 0)/n()), 
            `Mdn % of Chips in Set Labeled (Current)` = round(median(prop)),
            `IQR % of Chips in Set Labeled (Current)` = paste0(
              round(quantile(prop, c(0.25,0.75))), collapse = "-"),
            .groups = 'drop')

```

```{r, study1-gender, include = FALSE}

study1_genderbyterm <- naming_data %>%
  group_by(subj, género, color_cat) %>%
  summarise(prop = n()/165, .groups = 'drop') %>%
  complete(nesting(subj, género), color_cat, fill = list(prop = 0))

study1_ttest_gendertermprofusion <- with(
  study1_genderbyterm %>% 
   group_by(color_cat, género) %>%
   summarise(prop = mean(prop), .groups = 'drop') %>%
   spread(género, prop), t.test(femenino, masculino, paired = TRUE))

study1_ttest_gendertermappearance <- with(
  study1_genderbyterm %>% 
    mutate(used = ifelse(prop > 0, 1, 0)) %>%
    group_by(color_cat, género) %>%
    summarise(prop = mean(used), .groups = 'drop') %>%
    spread(género, prop), t.test(femenino, masculino))

```

Figure \@ref(fig:study1-figure) compares the original WCS data (Panel A) to a summary of  results (Panel B) along with the prevalence of Spanish-language responses (Panel C) for Experiment 1. All participants used the following set of color terms to describe a color chip at least once during their session: "joxo" (light/white), "wiso" (dark/black), "panshin" (yellow), "joshin" (red), and "yankon" (green/blue). Given the widespread use of this term set and their interpretations, we will refer to these five terms as SK-language BCTs. 

Most (`r filter(study1_profusion, color_cat == "Manxan") %>% pull('% of Subjects Who Used the Term (Current)')`%) participants also described at least 1 chip as "manxan" (faded), referring to a chip’s saturation. In addition, `r filter(study1_profusion, color_cat == "Naranja") %>% pull('% of Subjects Who Used the Term (Current)') %>% english::words()` percent of participants used the color term "naranja" (or "naransha") to describe at least one chip. Naranja may be known as a Spanish-language color term used to describe both the orange fruit and its associated color--as opposed to "anaranjado", a term strictly for the orange color. 

In terms of overall popularity, participants described a median of `r filter(study1_profusion, color_cat == "Yankon") %>% pull('Mdn % of Chips in Set Labeled (Current)')`% of chips as "yankon" (*IQR* = `r filter(study1_profusion, color_cat == "Yankon") %>% pull('IQR % of Chips in Set Labeled (Current)')`%) followed by "joshin" (*Mdn* = `r filter(study1_profusion, color_cat == "Joshin") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, *IQR* = `r filter(study1_profusion, color_cat == "Joshin") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), "panshin" (`r filter(study1_profusion, color_cat == "Panshin") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Panshin") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), "joxo" (`r filter(study1_profusion, color_cat == "Joxo") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Joxo") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), "manxan" (`r filter(study1_profusion, color_cat == "Manxan") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Manxan") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), and "wiso" (`r filter(study1_profusion, color_cat == "Wiso") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Wiso") %>% pull('IQR % of Chips in Set Labeled (Current)')`%). We failed to find any significant sex differences in the overall spread of color term usage across chip set (`r apa_print(study1_ttest_gendertermprofusion)$statistic`) or in the proportion of subjects who used a term at least once during their session (`r apa_print(study1_ttest_gendertermappearance)$statistic`).


```{r study1-langswitch}
study1_profusion_spanish <- study1_profusion %>%
  filter(color_cat %in% spanish_terms) %>% 
  arrange(desc(.$'% of Subjects Who Used the Term (Current)')) 

study1_switchperc_with_naranja <- naming_data %>%
  mutate(spanish_response = ifelse(
    color_cat %in% spanish_terms, 1, 0)) %>%
  mutate(overall_spanish = round(100*mean(spanish_response), 0)) %>%
  group_by(subj) %>%
  summarise(overall_spanish = first(overall_spanish),
            atleast_1 = ifelse(sum(spanish_response) > 0, 1, 0),
            by_subject = mean(spanish_response),
            .groups = 'drop') %>% 
  summarise(overall_spanish = first(overall_spanish),
            atleast_1 = round(100*mean(atleast_1)),
            mdn_subj_spanish = round(100*median(by_subject)),
            iqr_subj_spanish = paste0(
              round(100*quantile(by_subject, c(0.25, 0.75))), collapse = "-"),
            max_subj_spanish = round(100*max(by_subject)),
            min_subj_spanish = round(100*min(by_subject)),
            .groups = 'drop')

study1_switchperc_wo_naranja_base <- naming_data %>%
  mutate(spanish_response = ifelse(
    color_cat %in% spanish_terms & color_cat != "Naranja",
                                   1, 0)) %>%
  mutate(overall_spanish = round(100*mean(spanish_response), 0)) %>%
  group_by(subj) %>%
  summarise(overall_spanish = first(overall_spanish),
            atleast_1 = ifelse(sum(spanish_response) > 0, 1, 0),
            by_subject = mean(spanish_response),
            .groups = 'drop') 

study1_switchperc_wo_naranja <- study1_switchperc_wo_naranja_base%>% 
  summarise(overall_spanish = first(overall_spanish),
            atleast_1 = round(100*mean(atleast_1)),
            mdn_subj_spanish = round(100*median(by_subject)),
            iqr_subj_spanish = paste0(
              round(100*quantile(by_subject, c(0.25, 0.75))), collapse = "-"),
            max_subj_spanish = round(100*max(by_subject)),
            min_subj_spanish = round(100*min(by_subject)),
            .groups = 'drop')


study1_spanishbychip <- naming_data %>%
  mutate(spanish_response = ifelse(
    color_cat %in% spanish_terms & color_cat != "Naranja",
                                   1, 0)) %>%
  select(subj, chip_id, spanish_response) %>%
  mutate(set = ifelse((chip_id %% 2) == 0, 'even', 'odd')) %>%
  split(.$set) %>%
  map_df(function(x) {
    x %>%
      group_by(chip_id) %>%
      summarise(perc = mean(spanish_response), .groups = 'drop')
  }) %>%
  left_join(color_chip_data %>% select("#cnum", "hex"),
            by = c("chip_id" = "#cnum")) %>%
  arrange(desc(perc)) %>%
  rename(`Chip ID` = chip_id, `% of Subjects` = perc, `Hex Code` = hex)

# study1_highestspanish <- datatable(study1_spanishbychip, rownames = FALSE) %>%
#   formatPercentage("% of Subjects", 0) %>%
#   formatStyle(columns = "Hex Code",
#               background = styleEqual(
#                 study1_spanishbychip$`Hex Code`, study1_spanishbychip$`Hex Code`))

```

Compared to the WCS dataset which only reported SK language terms, Spanish use was prevalent throughout Study 1. `r study1_switchperc_with_naranja$atleast_1 %>% english::Words()` percent of our participants used a Spanish-language color term to describe at least 1 chip, which accounted for only `r study1_switchperc_with_naranja$overall_spanish`% of all responses. Across chips, the most common Spanish-language color term was "`r study1_profusion_spanish %>% pull(color_cat) %>% first() %>% tolower`" (`r study1_profusion_spanish %>% pull('% of Subjects Who Used the Term (Current)') %>% first()`% of participants), followed by "`r study1_profusion_spanish %>% pull(color_cat) %>% nth(2) %>% tolower`" (`r study1_profusion_spanish %>% pull('% of Subjects Who Used the Term (Current)') %>% nth(2)`) and "`r study1_profusion_spanish %>% pull(color_cat) %>% nth(3) %>% tolower`" (`r study1_profusion_spanish %>% pull('% of Subjects Who Used the Term (Current)') %>% nth(3)`). Spanish use peaked at `r round(100*max(study1_spanishbychip$'% of Subjects'))`% when participants were asked to label chips that English speakers would consider to be orange or "anaranjado"/"naranja" by Spanish speakers. Indeed, the relatively common use of "naranja" by these adult SK speakers despite being prompted entirely in SK brings the possibility that "naranja" has been adopted into the SK color lexicon. If we allow "naranja" to be counted as an SK rather than Spanish-language term, then only `r study1_switchperc_wo_naranja$atleast_1`% of participants used a Spanish-language term other than "naranja" at least once throughout the study, accounting for `r study1_switchperc_wo_naranja$overall_spanish`% of all responses. One participant responded in Spanish in `r study1_switchperc_wo_naranja$max_subj_spanish`% of the time despite being prompted solely in SK. 

```{r study1-consensus}

study1_consensus <- naming_data %>%
  select(subj, chip_id, color_cat) %>%
  mutate(set = ifelse((chip_id %% 2) == 0, 'even', 'odd')) %>%
  split(.$set) %>%
  map_df(function(x) {
    x %>%
      group_by(chip_id, color_cat) %>%
      summarise(n = n(), .groups = 'drop') %>%
      group_by(chip_id) %>%
      mutate(perc = 100*n/sum(n)) %>%
      select(-n)
  }) %>%
  arrange(chip_id) %>%
  rename(`Chip ID` = chip_id, `Color Term` = color_cat, `% of Subjects` = perc) 


```

```{r study1-figure, fig.cap = "(A and B) Plots of the modal term given for a particular chip. Color coordinates were represented in 2-D Munsell space. Modal responses were given by SK adults during (A) our Study 1 and during (B) the original World Color Survey. (C) Heat map of prevalence of Spanish-language responses during Study 1. Legends for all three subplots located in the bottom-right quadrant."}

study1_consensus_plot <- ggplot(study1_consensus %>%
                                 group_by(`Chip ID`) %>%
                                 filter(`% of Subjects` == max(`% of Subjects`)) %>%
                                 left_join(color_chip_data, by = c("Chip ID" = "#cnum")), 
                               aes(x = H, y = V, fill = `Color Term`)) + 
  geom_tile() + 
  scale_size(range = c(0, 2.0)) + 
  scale_fill_manual(name = "Color Term",values = graph_colors) +
  ggtitle("Study 1") +
  guides(fill=guide_legend(ncol=2,byrow=TRUE)) +
  theme(plot.title = element_text(hjust = 0.5))

kay_consensus <- kay_terms %>%
  mutate(Term = ifelse(Term %in% c('Huiso', 'Wiso'), 'Wiso', as.character(Term))) %>%
  group_by(`WCS Chip Number`, Term) %>%
  summarise(n = n(), .groups = 'drop') %>%
  group_by(`WCS Chip Number`) %>%
  mutate(`% of Subjects` = 100*n/sum(n)) %>%
  select(-n) %>%
  group_by(`WCS Chip Number`) %>%
  filter(`% of Subjects` == max(`% of Subjects`)) %>%
  dplyr::rename(`Color Term` = Term, `Chip ID` = `WCS Chip Number`) %>%
  left_join(color_chip_data, by = c("Chip ID" = "#cnum"))


kay_consensus_plot <- ggplot(kay_consensus, 
                             aes(x = H, y = V, fill = `Color Term`)) + 
  geom_tile() + 
  scale_size(range = c(0, 2.0)) + 
  scale_fill_manual(name = "Color Term",values = graph_colors) +
  ggtitle("WCS Data") +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5))

study1_spanish_plot <- study1_spanishbychip %>%
  mutate(`% of Subjects` = 100*`% of Subjects`) %>%
  rename(`Spanish Term` = `% of Subjects`) %>%
  left_join(select(color_chip_data, `#cnum`, V, H), 
            by = c("Chip ID" = "#cnum")) %>%
  ggplot(., aes(x = H, y = V)) + 
  geom_tile(aes(fill = `Spanish Term`)) + 
  scale_fill_viridis(option="magma", lim = c(0, 20), breaks = seq(0,20,5)) +
  labs(fill = "Spanish\nUse (%)")

adult_figurelegends <- plot_grid(
  get_legend(study1_consensus_plot),
  NULL,
  get_legend(study1_spanish_plot),
  # labels = c("A and B", "", "C"),
  ncol = 3) + 
  theme(plot.margin = unit(c(0.5,0.5,0.5,1), "in")) 

adult_figure <- plot_grid(
  study1_consensus_plot + theme(legend.position = "none"), 
  kay_consensus_plot + theme(legend.position = "none"), 
  study1_spanish_plot + theme(legend.position = "none"), 
  adult_figurelegends, 
  labels = c("A", "B", "C"), ncol = 2
  )

print(adult_figure)

# study1_spanishbysubj <- naming_data %>%
#   mutate(spanish_response = ifelse(color_cat %in% spanish_terms & color_cat != "Naranja", 1, 0)) %>%
#   group_by(subj) %>%
#   summarise(age = as.numeric(as.character(first(edad))),
#             age_introduction = first(`edad aprendizaje del espanol`),
#             mean_spanish = mean(spanish_response, na.rm = TRUE),
#             .groups = 'drop')
# 
# study1_spanishbyintro_test <- cor.test(~ age_introduction + mean_spanish, data = study1_spanishbysubj)
# study1_spanishbyage_test <- cor.test(~ age + mean_spanish, data = study1_spanishbysubj)

```




```{r study1-termnature}
study1_nature_wo_naranja <- naming_data %>%
  mutate(spanish_response = ifelse(
    color_cat %in% spanish_terms & color_cat != "Naranja", 1, 0),
         nature = ifelse(grepl("SLT", nature), "SLT", nature)) %>%
  group_by(subj, spanish_response, nature) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(nature = ifelse(is.na(nature), "Other", nature)) %>%
  complete(subj, spanish_response, nature, fill = list(n = 0)) %>%
  group_by(subj) %>%
  mutate(perc = 100*n/sum(n)) %>%
  group_by(spanish_response, nature) %>%
  summarise(mdn_prop = round(median(perc)),
            iqr_prop = paste0(round(quantile(perc, c(0.25, 0.75))), collapse = "-"),
            .groups = "drop")

study1_nature_with_naranja <- naming_data %>%
  mutate(spanish_response = ifelse(
    color_cat %in% spanish_terms, 1, 0),
         nature = ifelse(grepl("SLT", nature), "SLT", nature)) %>%
  group_by(subj, spanish_response, nature) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(nature = ifelse(is.na(nature), "Other", nature)) %>%
  complete(subj, spanish_response, nature, fill = list(n = 0)) %>%
  group_by(subj) %>%
  mutate(perc = 100*n/sum(n)) %>%
  group_by(spanish_response, nature) %>%
  summarise(mdn_prop = round(median(perc)),
            iqr_prop = paste0(round(quantile(perc, c(0.25, 0.75))), collapse = "-"),
            .groups = "drop")

SK_AHCT_prop <- group_by(naming_data, subj) %>%
  summarise(SK_AHCT = sum(!color_cat %in% spanish_terms & nature == "AHCT", na.rm = T),
            .groups = 'drop') %>%
  summarise(round(100*mean(SK_AHCT > 0)), .groups = 'drop')

```

Participants used an SK-language BCT (i.e., "yankon") to describe a median of `r filter(study1_nature_wo_naranja, nature == "BCT" & spanish_response == 0) %>% pull(mdn_prop)`% of chips (*IQR* = `r filter(study1_nature_wo_naranja, nature == "BCT" & spanish_response == 0) %>% pull(iqr_prop)`%). Besides BCTs, `r SK_AHCT_prop`% of participants used SK-language ad hoc hue terms (i.e., "nai" or sky for blue chips) for an overall median of `r filter(study1_nature_wo_naranja, nature == "AHCT" & spanish_response == 0)$mdn_prop`% of chips  (*IQR* = `r filter(study1_nature_wo_naranja, nature == "AHCT" & spanish_response == 0)$iqr_prop`%). SK-language terms referring to saturation or luminosity of a chip, such as "manxan" (faded) were used for an overall median of `r filter(study1_nature_wo_naranja, nature == "SLT" & spanish_response == 0)$mdn_prop`% of chips (*IQR* = `r filter(study1_nature_wo_naranja, nature == "SLT" & spanish_response == 0)$iqr_prop`%). Most instances (`r filter(naming_data, color_cat %in% spanish_terms & color_cat != "Naranja") %>% summarise(round(100*sum(nature == "BCT")/n()), .groups = 'drop')`%) of Spanish use involved a Spanish BCT such as "rojo" (overall *Mdn* = `r filter(study1_nature_wo_naranja, nature == "BCT" & spanish_response == 1)$mdn_prop`%, *IQR* = `r filter(study1_nature_wo_naranja, nature == "BCT" & spanish_response == 1)$iqr_prop`%). 

In sum, our data show similar variability to the WCS data, but with Spanish terms (as described above) mixed in with ad hoc terms. Notably, we observed the modal term for a few chips to be loanwords from Spanish, in some cases already established as part of the SK vocabulary (the last seems to be the case of "naranja", "orange" in English), suggesting some fairly extensive borrowing of Spanish words due to the close relation between both languages in the studied communities.

```{r study1-entropy-values}

study1_entropy <- naming_data %>%
  group_by(chip_id, color_cat) %>% 
  select(chip_id, color_cat) %>%
  count %>%
  group_by(chip_id) %>%
  mutate(p = n / sum(n)) %>%
  summarise(entropy = - sum(p * log(p)), .groups = 'drop') %>%
  rename(`Chip ID` = chip_id, 
         Entropy = entropy)

study1_naturebyentropy <- naming_data %>%
  mutate(response_language = case_when(
    color_cat %in% spanish_terms & color_cat != "Naranja" ~ "spanish",
    color_cat %in% shipibo_terms ~ "shipibo"
  )) %>%
  select(subj, chip_id, color_cat, response_language, nature) %>%
  mutate(shipibo_BCT = ifelse(nature == "BCT" & response_language == "shipibo", 1, 0),
         shipibo_AHCT = ifelse(nature == "AHCT" & response_language == "shipibo", 1, 0),
         spanish_BCT = ifelse(nature == "BCT" & response_language == "spanish", 1, 0),
         spanish_AHCT = ifelse(nature == "AHCT" & response_language == "spanish", 1, 0)) %>%
  mutate(across(shipibo_BCT:spanish_AHCT, ~ifelse(is.na(.), 0, .))) %>%
  group_by(chip_id) %>%
  summarise(across(shipibo_BCT:spanish_AHCT, ~ mean(., na.rm = TRUE)), .groups = 'drop') %>%
  right_join(study1_entropy, by = c("chip_id" = "Chip ID")) %>%
  select(`Chip ID` = chip_id, Entropy, ends_with("CT", ignore.case = FALSE))

## A little circular for a correlation?
study1_naturebyentropy_test <- cor.test(~ shipibo_BCT + Entropy, data = study1_naturebyentropy)

study1_selectedchips_table <- study1_entropy %>%
  mutate(`Chip ID` = as.numeric(as.character(`Chip ID`)),
         `Study 2` = ifelse(`Chip ID` %in% shipibo_chip_set$chip_id, "×", ""),
         `Study 3` = ifelse(`Chip ID` %in% spanish_chip_set$chip_id, "×", ""),
         Entropy = round(Entropy, 2)) %>%
  right_join(all_chip_sets %>% 
               select(`Shipibo term` = shipibo, `Spanish term` = spanish, chip_id) %>%
               mutate(`Shipibo term` = ifelse(is.na(`Shipibo term`), "-", `Shipibo term`)), by = c("Chip ID" = "chip_id")) %>%
  mutate(`Chip ID` = as.character(round(`Chip ID`)))

```


```{r study1-entropy-plot}


study1_naturebyentropy_plot <- ggplot(study1_naturebyentropy %>% 
         gather(key = "measure", value = "prop", ends_with("CT")) %>%
         separate(measure, c("language", "nature"), sep = "_") %>%
         mutate(language = tools::toTitleCase(language),
                nature = case_when(
                  nature == "BCT" ~ "Basic color term",
                  nature == "AHCT" ~ "Ad hoc color term"),
                language = relevel(factor(language), ref = "Shipibo"),
                nature = relevel(factor(nature), ref = "Basic color term")),
       aes(x = Entropy, y = prop, group = interaction(language, nature), colour = language, shape = nature)) +
  geom_smooth(method = "loess", aes(fill = language, linetype = nature), alpha = .2) +
  labs(x = "Labelling Entropy of Chip", 
       y = "Proportion of Responses", 
       fill = "Language", 
       color = "Language", 
       linetype = "Nature of Response") +
  ggthemes::scale_fill_ptol() +
  ggthemes::scale_color_ptol() +
  coord_cartesian(ylim = c(0,1)) +
  theme_apa()

# print(study1_naturebyentropy_plot)

```


# Study 2

After generating an updated SK color term map using the responses from adult participants in Study 1, we designed Study 2 to assess child participants’ production and comprehension of SK color terms. Because we did not think that we could feasibly ask children across a range of ages about more than 100 color chips, we selected a subset of chips representing the prototypical instances for prominent SK terms from Study 1.

```{r study2-participants}

study2_prod_data <- raw_data %>%
  filter(language == "Shipibo" & task == "Production") %>%
  mutate(spanish_response = ifelse(response %in% spanish_terms & response != "Naranja", 1, 0)) 

study2_participants <- study2_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% ungroup() %>%
  summarise(min_age = min(age_interval),
            max_age = max(age_interval),
            num_56 = sum(age_interval %in% 5:6),
            num_78 = sum(age_interval %in% 7:8),
            num_910 = sum(age_interval %in% 9:10),
            num_1112 = sum(age_interval %in% 11:12),
            num_benajema = sum(location == 'bena jema'),
            num_bilingue = sum(location == 'bilingue'),
            num_ccnn = sum(location == 'c.c.n.n. (bahuanisho)'),
            num_boys = sum(gender == "masculino"),
            num_total = n(),
            .groups = 'drop')
```

```{r study3-participants}


study3_prod_data <- raw_data %>%
  filter(language == "Spanish" & task == "Production") %>%
  mutate(shipibo_response = ifelse(response %in% shipibo_terms & response != "Naranja", 1, 0)) 

study3_participants <- study3_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% ungroup() %>%
  summarise(min_age = min(age_interval),
            max_age = max(age_interval),
            num_56 = sum(age_interval %in% 5:6),
            num_78 = sum(age_interval %in% 7:8),
            num_910 = sum(age_interval %in% 9:10),
            num_1112 = sum(age_interval %in% 11:12),
            num_benajema = sum(location == 'bena jema'),
            num_bilingue = sum(location == 'bilingue'),
            num_ccnn = sum(location == 'c.c.n.n. (bahuanisho)'),
            num_boys = sum(gender == "masculino"),
            num_total = n(), 
            .groups = 'drop')
```



```{r study23-demographics, results='asis'}

study2_demographics <- study2_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% group_by(age_interval) %>%
  summarise(num_total = n(),
            num_boys = sum(gender == 'masculino'),
            mean_age = round(mean(age), 1),
            sd_age = round(sd(age), 2),
            .groups = 'drop') %>% ungroup() %>%
  mutate(freq_total = round(100*num_total/sum(num_total)),
         freq_boys = round(100*num_boys/num_total)) %>%
  mutate(`Age Group` = as.character(age_interval),
         `n` = paste0(num_total, " (", freq_total, "%", ifelse(`Age Group` == "5", " of overall sample", ""), ")"),
         `Boys` = num_boys) %>%
  select(`Age Group`, `n`, `Boys`)
  
# apa_table(study2_demographics, caption = "Demographics of participants in Study 2.")

study3_demographics <- study3_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% group_by(age_interval) %>%
  summarise(num_total = n(),
            num_boys = sum(gender == 'masculino'),
            mean_age = round(mean(age), 1),
            sd_age = round(sd(age), 2),
            .groups = 'drop') %>%
  mutate(freq_total = round(100*num_total/sum(num_total)),
         freq_boys = round(100*num_boys/num_total)) %>%
  mutate(`Age Group` = as.character(age_interval),
         `n` = paste0(num_total, " (", freq_total, "%", ifelse(`Age Group` == "5", " of overall sample", ""), ")"),
         `Boys` = num_boys) %>%
  select(`Age Group`, `n`, `Boys`)
  
# apa_table(study3_demographics, caption = "Demographics of participants in Study 3.")

apa_table(
  list(`Study 1` = study2_demographics, `Study 2` = study3_demographics),
  caption = "Demographics of participants in Studies 2 and 3.",
  added_stub_head = "Variables",
  merge_method = "table_spanner")

```

## Methods

### Participants

`r study2_participants$num_total %>% english::Words()` children (`r study2_participants$num_boys` boys) ages `r study2_participants$min_age`- to `r study2_participants$max_age`-years-old were recruited in predominantly SK neighborhoods in Yarinacocha (Nueva Era and Bena Jema) and in Bawanisho, a native community settled along the Ucayali River, more than 500 kilometers southeast of Pucallpa. Recruitment occurred either through direct contact with interested parents or through their local school. If recruited via school, consent for participation had to be given by both teacher and parent. Outside of the school environment, consent was given by the parent. 

### Materials and procedure

Based on the findings of Study 1, we chose 8 color chips from our original set of 330 to serve as prototypical instances of major SK color terms. These color chips were blue (WCS n°1), green (n°234), red (n°245), white (n°274), yellow (n°297), black (n°312), greenish-yellow (WCS n°320), and purple (WCS n°325). Study 2 was conducted entirely in SK and participants were explicitly instructed to give responses in SK as opposed to Spanish. In the production and comprehension tasks, children sat at a table across from the experimenter with color chips arranged between them. The production task was always performed before the comprehension task.

### Production task

Similar to Study 1, the experimenter introduced the participant to the general procedure and the goals of the study. The experimenter would then ask: "What is the color of this chip?". As in Study 1, we used follow-up questions to elicit a BCT when the child’s initial response was not a BCT. In a departure from Study 1, we were more explicit in soliciting an SK-language response. When a participant provided a Spanish-language term, the experimenter would record their response but further ask: "What is the name of this color in SK?". If a participant could not respond with an SK term, the experimenter would not ask further questions and would move forward to the next chip. As a result, some children only produced SK non-BCTs or Spanish-language terms for particular chips. 

### Comprehension task

The comprehension task had a notably different procedure compared to the preceding production task or that of Study 1. We tested the comprehension of 9 SK color terms. The choice of these terms was based on common responses given by adult participants in Study 1. The color term prompts included BCTs: "yankon" (green/blue), "joshin" (red), "panshin" (yellow), "joxo" (white/light), "wiso" (black/dark). We also included non-basic but prominent terms as prompts which were "nai" (sky or sky blue), and "barin poi" (greenish-yellow, meaning the Sun´s excrement, also used to refer to an alga) and two dyads of non-basic terms: "pei" (leaf)  and "xo" (unripe) to represent the color green along with "ami" (a type of tree used to dye fabrics) "pua" (sachapapa, a tuber) to represent purple. Children sat at a table across from the experimenter with the 8 color chips of the production task displayed between them. The experimenter asked: "Can you give me the [*color term*] chip?" Participants chose one of the 8 chips and their response was recorded.  

Our findings from Study 1 suggested that color terms varied in their degrees of specificity. For example, "wiso" best describes a narrow range of very dark to black. By contrast, "yankon" could encompass blue, green, greenish-yellow, and purple; "joshin" could describe red, purple, and orange; "pei" or "xo" could describe green or greenish-yellow. In cases where a term could apply to multiple chips (i.e., "yankon"), the chip selected first would be removed from the table, leaving 7 remaining chips. The experimenter would then ask: "Can you give me another [*color term*] chip?". The participant would then pick another one of the 7 chips, have their response recorded, and so on. We prompted participants 4 times for "yankon" and 2 times each for "joshin" and "pei"/"xo"; every other term only received a single prompt. Due to the inherent ambiguity in term-hue pairings, accuracy for a child participant was coded based on adult responses given during Study 1. If at least 15% of adult participants in Study 1 associated a chip with a particular term, we coded a similar term-chip pairing from a child participant as correct. Some trials could have multiple pairings; in those cases, accuracy was scored as an average, rather than as dichotomous. For instance, if a child correctly chose 3 out of 4 chips for the "yankon" trial, instead of 1 (correct) or 0 (incorrect) they would receive a score of 0.75.


```{r prod-childfigure, fig.height = 9.5, fig.cap = "(A and B) A comparison of children's performance during the production task in Studies 2 (top) and 3 (bottom). Solid or dotted lines represent overall performance by age for a particular chip. Solid lines show whether the child gave a correct answer in the language indicated in that column; dotted lines show if they gave a response that was correct in either language. Line colors are representative of the chip’s color coordinates."}

study23_firstprod <- raw_data %>% 
  filter(task == 'Production' & response_order %in% c('first','only')) %>%
  rename(study = language) %>% mutate(prompt = as.character(prompt),
    study = case_when(
      study == "Shipibo" ~ "Study 2",
      study == "Spanish" ~ "Study 3"),
    correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent),
    correct_all = correct_either + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent)) %>%
  group_by(study, age, prompt) %>%
  gather(key = "criteria", value = "score", 
         starts_with("correct")) %>%
  left_join(study1_entropy %>% 
              mutate(`Chip ID` = as.character(`Chip ID`)), 
            by = c("prompt" = "Chip ID"))

plot_accuracyvsentropy <- function(df) {
  
  df_correct <- filter(df, criteria == "correct") %>%
    group_by(study, age_interval, prompt, criteria) %>%
    summarise(score = mean(score, na.rm = T), .groups = 'drop')
  
  accuracyvsentropy_plot <- ggplot(df %>% filter(criteria != "correct_all"), 
                                   aes(x = age_interval, y = score, colour = prompt,
                           group = criteria, linetype = criteria)) +
  geom_jitter(data = df_correct,
    alpha = .4, width = .3, height = .1, col = "gray") + 
  geom_smooth(se = FALSE, method = "loess", span = 1) +
  facet_wrap(~ as.character(as.numeric(prompt)), scales = "free", ncol = 3) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
  xlim(c(5,11.5)) +
  scale_color_manual(values = chip_id_colors, guide = FALSE) +
  scale_linetype_manual(values = graph_lines, guide = FALSE) +
  labs(x = "Age", y = "Proportion of Correct Responses", 
       linetype = "Measure", colour = "Chip ID") +
  guides(label = "none") + 
  geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
                 label = sprintf("%.2f", round(Entropy,2))),
             show.legend = FALSE, colour = "black") + 
    theme(legend.position = "none")
  
  return(accuracyvsentropy_plot)
}

study2_firstprod <- study23_firstprod %>% filter(study == "Study 2")
study3_firstprod <- study23_firstprod %>% filter(study == "Study 3")

prod_accuracyvsage_2 <- plot_accuracyvsentropy(study2_firstprod)

prod_accuracyvsage_3 <- plot_accuracyvsentropy(study3_firstprod)

prod_childfigure <- plot_grid(prod_accuracyvsage_2 + theme(axis.title.x = element_blank()), 
          prod_accuracyvsage_3, labels = c("A", "B"), rel_heights = c(3,4), ncol = 1)

# print(prod_childfigure)

```


```{r study2-prodtable, results='asis'}

# study2_firstprod_table <- study2_firstprod %>% 
#   filter(criteria == "correct") %>%
#   group_by(age_interval, prompt, spanish) %>%
#   summarise(n = n(), 
#             prop = round(mean(score), 2),
#             .groups = "drop") %>%
#   bind_rows(
#     study2_firstprod %>% 
#     filter(criteria == "correct") %>%
#     group_by(age_interval) %>%
#     summarise(n = n_distinct(subj),
#               prop = round(mean(score), 2),
#               prompt = "Overall",
#               spanish = "",
#               .groups = "drop")
#   )  %>%
#   mutate(
#     age_interval = case_when(
#       age_interval == 5 ~ sprintf("%d-years-old (%d children)", age_interval, n),
#       age_interval > 5 ~ sprintf("%d-years-old (%d)", age_interval, n)
#     ),
#     prompt = case_when(
#       spanish != "" ~ sprintf("n°%s (%s)", prompt, spanish),
#       spanish == "" ~ prompt
#   )) %>%
#   select(-n, -spanish) %>%
#   pivot_wider(names_from = age_interval, values_from = prop)

# apa_table(study2_firstprod_table, caption = "Demographics of participants in Study 2.")

```


```{r study2-prod-model-overall}

study2_firstprod$age.years.c <- scale(study2_firstprod$age, scale = FALSE)

# Earlier models failed to converge with random slope for age
# Thoughts on adjusting for gender?
study2_firstprod_same <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct"), 
      family = "binomial")

study2_firstprod_either <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct_either"), 
      family = "binomial")

study2_firstprod_adjacent <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct_nearby"), 
      family = "binomial")

study2_firstprod_all <- glmer(score ~ age.years.c*criteria + (1 | prompt) + (1 | subj), 
      data = mutate(study2_firstprod, criteria = factor(criteria)), 
      family = "binomial")

# XXX Doesn't converge? Dropped random slope for age
# study2_firstprod_same <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
#       data = filter(study2_firstprod, criteria == "correct"), 
#       family = "binomial")

# study2_firstprod_same_noage <- glmer(score ~ (1 | prompt) + (1 | subj), 
#       data = filter(study2_firstprod, criteria == "correct"), 
#       family = "binomial")

# study2_firstprod_either <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
#       data = filter(study2_firstprod, criteria == "correct_either"), 
#       family = "binomial")

# study2_firstprod_adjacent <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
#       data = filter(study2_firstprod, criteria == "correct_nearby"), 
#       family = "binomial")

# study2_firstprod_all <- glmer(score ~ age.years.c*criteria + (age.years.c | prompt) + (1 | subj), 
#       data = mutate(study2_firstprod, criteria = factor(criteria)), 
#       family = "binomial")


```

```{r study3-prod-model-overall}

study3_firstprod$age.years.c <- scale(study3_firstprod$age, scale = FALSE)

study3_firstprod_same <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct"), 
      family = "binomial")

# study3_firstprod_same_noage <- glmer(score ~ (1 | prompt) + (1 | subj), 
#       data = filter(study3_firstprod, criteria == "correct"), 
#       family = "binomial")

study3_firstprod_either <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct_either"), 
      family = "binomial")

study3_firstprod_adjacent <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct_nearby"), 
      family = "binomial")

study3_firstprod_all <- glmer(score ~ age.years.c*criteria + (1 | prompt) + (1 | subj), 
      data = mutate(study3_firstprod, criteria = factor(criteria)), 
      family = "binomial")

```


```{r study2-prod-model-original}

# study2_prod_predict <- with(study2_firstprod, expand.grid(subj = NA, prompt = unique(prompt), age.years.c = seq(min(age.years.c), max(age.years.c),0.05)))
# 
# study2_prod_predict$fit <- predict(study2_firstprod_same, newdata = study2_prod_predict, re.form = NA, type = "response")
# 
# study2_prod_predict$age <- study2_prod_predict$age.years.c + attr(study2_firstprod$age.years.c , 'scaled:center')
# 
# study2_prod_predict <- study2_prod_predict %>%
#   left_join(mutate(shipibo_chip_set, chip_id = factor(as.character(chip_id))), by = c("prompt" = "chip_id")) %>%
#   select(-subj, prompt, shipibo:munsell_code, age.years.c, age, fit)
# 
#   study2_model_compare <- study23_firstprod %>% 
#     filter(study == "Study 2" & criteria == "correct" & !is.na(score)) %>%
#     group_by(prompt, Entropy, age_interval) %>%
#     summarise(score = mean(score), n = n_distinct(subj),
#               .groups = 'drop') %>%
#     ggplot(., aes(x = age_interval, y = score, colour = prompt)) +
#     geom_point(aes(size = n)) +
#     geom_line(data = study2_prod_predict, mapping = aes(x = age, y = fit)) +
#     facet_wrap(~ as.character(prompt), scales = "free", ncol = 3) +
#     scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
#     xlim(c(5,11.5)) +
#     scale_color_manual(values = chip_id_colors, guide = FALSE) +
#     labs(x = "Age", y = "Proportion of Correct Responses", colour = "Chip ID") +
#     guides(label = "none") + 
#     geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
#                    label = sprintf("%.2f", round(Entropy,2))),
#                show.legend = FALSE, colour = "black") + 
#     theme_apa()
  
```


```{r study2-prod-model-byprompt}

# study2_firstprod$age.years.c <- scale(study2_firstprod$age, scale = FALSE)
# 
# fit_glm <- function(df) {
#   mdl <- glmer(score ~ age.years.c + (1 | subj), data = df, family = "binomial")
#   
#   new.df <- with(study2_firstprod, data.frame(subj = NA, age.years.c = seq(min(age.years.c), max(age.years.c),0.05)))
#   
#   new.df$fit <- predict(mdl, newdata = new.df, re.form = NA, type = "response")
#   new.df$prompt <- first(df$prompt)
#   
#   return(new.df)
# }
# 
# y <- study2_firstprod %>%
#   filter(criteria == "correct") %>%
#   split(.$prompt) %>%
#   map_df(fit_glm) %>%
#   mutate(age = age.years.c + attr(study2_firstprod$age.years.c , 'scaled:center')) %>%
#   left_join(mutate(shipibo_chip_set, chip_id = factor(as.character(chip_id))), by = c("prompt" = "chip_id")) %>%
#   select(-subj, prompt, shipibo:munsell_code, age.years.c, age, fit)
# 
# 
# y2_model_compare <- study23_firstprod %>% 
#   filter(study == "Study 2" & criteria == "correct" & !is.na(score)) %>%
#   group_by(prompt, Entropy, age_interval) %>%
#   summarise(score = mean(score), n = n_distinct(subj),
#             .groups = 'drop') %>%
#   ggplot(., aes(x = age_interval, y = score, colour = prompt)) +
#   geom_point(aes(size = n)) +
#   geom_line(data = y, mapping = aes(x = age, y = fit)) +
#   facet_wrap(~ as.character(prompt), scales = "free", ncol = 3) +
#   scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
#   xlim(c(5,11.5)) +
#   scale_color_manual(values = chip_id_colors, guide = FALSE) +
#   labs(x = "Age", y = "Proportion of Correct Responses", colour = "Chip ID") +
#   guides(label = "none") + 
#   geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
#                  label = sprintf("%.2f", round(Entropy,2))),
#              show.legend = FALSE, colour = "black") + 
#   theme_apa()

```


```{r study2-prod-model-aoa}


fit_robust <- function(df) {
  
  mdl <- robustbase::glmrob(score ~ age, data = df, family = "binomial")
  
  new.df <- with(study2_firstprod, data.frame(age = seq(min(age), max(age),0.1)))
  new.df <- cbind(new.df, predict(mdl, newdata = new.df, re.form = NA, type = "response", se.fit = TRUE))
  new.df$coef_age <- mdl$coefficients["age"]
  new.df$prompt <- first(df$prompt)
  
  return(new.df)
}

study2_prod_predict <- study2_firstprod %>%
  filter(criteria == "correct") %>%
  split(.$prompt) %>%
  map_df(fit_robust) %>%
  left_join(mutate(shipibo_chip_set, chip_id = factor(as.character(chip_id))), by = c("prompt" = "chip_id")) %>%
  select(prompt, shipibo:munsell_code, age, fit, se.fit, coef_age)

study2_prod_predict_aoa <- study2_prod_predict %>% 
  group_by(prompt) %>% 
  filter(fit >= 0.5 | row_number() == max(row_number())) %>% 
  filter(row_number() == min(row_number())) %>%
  mutate(aoa = as.character(round(age, 1)))


study2_prod_predict_plot <- study23_firstprod %>% 
  filter(study == "Study 2" & criteria == "correct" & !is.na(score)) %>%
  group_by(prompt, Entropy, age_interval) %>%
  summarise(score = mean(score), n = n_distinct(subj),
            .groups = 'drop') %>%
  left_join(study2_prod_predict_aoa, by=("prompt")) %>%
  ggplot(., aes(x = age_interval, y = score, colour = prompt)) +
  geom_point(aes(size = n)) +
  geom_line(data = study2_prod_predict, mapping = aes(x = age, y = fit)) +
  facet_wrap(~ as.character(prompt), scales = "free", ncol = 3) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
  scale_x_continuous(lim = c(5,12), breaks = seq(5,11,2)) +
  scale_color_manual(values = chip_id_colors, guide = FALSE) +
  labs(x = "Age", y = "Proportion of Correct Responses", colour = "Chip ID") +
  guides(label = "none") + 
  geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
                 label = sprintf("Entropy: %.2f\nAoA: %s", round(Entropy,2), aoa)),
             show.legend = FALSE, colour = "black") + 
  theme_apa()


```

```{r study2-accuracyswitchentropy, results='asis'}

study2_overallscore <- study2_prod_data %>%
  group_by(subj, age) %>%
  summarise(correct = mean(correct, na.rm = T), .groups = 'drop')

study2_overallscore_test <- cor.test(~ correct + age, data = study2_overallscore)

study2_overallswitch <- study2_prod_data %>%
  group_by(subj, age, prompt) %>%
  summarise(spanish_response = ifelse(sum(spanish_response) >= 1, 1, 0), .groups = 'drop_last') %>%
  summarise(n_spanish = sum(spanish_response),
            n_trials = n(),
            perc_spanish = n_spanish/n_trials, 
            .groups = 'drop')

study2_overallswitch_test <- cor.test(~ n_spanish + age, data = study2_overallswitch)


study2_switchperc <- study2_prod_data %>% ungroup() %>%
  mutate(response_order = case_when(
    response_order %in% c("only", "first") ~ "first",
    response_order %in% c("middle", "last") ~ "subsequent"),
    overall_response = round(100*mean(spanish_response))) %>% 
  group_by(overall_response, response_order) %>%
  summarise(spanish_response = round(100*mean(spanish_response)),
            .groups = 'drop')

study2_switchbyentropy <- study2_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID"))

study2_switchbyentropy$age.years.c <- scale(study2_switchbyentropy$age, scale = FALSE)[,1]

study2_SwitchEnt_model <- lme4::glmer(
  spanish_response ~ age.years.c * Entropy + (1|subj),
  data=study2_switchbyentropy, family = "binomial")

# apa_table(apa_print(study2_SwitchEnt_model)$table)

```

```{r study3-accuracyswitchentropy, results='asis'}

study3_overallscore <- study3_prod_data %>%
  group_by(subj, age) %>%
  summarise(correct = mean(correct, na.rm = T), .groups = 'drop')

study3_overallscore_test <- cor.test(~ correct + age, data = study3_overallscore)

study3_overallswitch <- study3_prod_data %>%
  group_by(subj, age, prompt) %>%
  summarise(shipibo_response = ifelse(sum(shipibo_response) >= 1, 1, 0), .groups = 'drop_last') %>%
  summarise(n_shipibo = sum(shipibo_response),
            n_trials = n(),
            perc_shipibo = n_shipibo/n_trials, 
            .groups = 'drop')

study3_overallswitch_test <- cor.test(~ n_shipibo + age, data = study3_overallswitch)

study3_switchperc <- study3_prod_data %>% ungroup() %>%
  mutate(response_order = case_when(
    response_order %in% c("only", "first") ~ "first",
    response_order %in% c("middle", "last") ~ "subsequent"),
    overall_response = round(100*mean(shipibo_response))) %>% 
  group_by(overall_response, response_order) %>%
  summarise(shipibo_response = round(100*mean(shipibo_response)),
            .groups = 'drop')

study3_switchbyentropy <- study3_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID"))


study3_switchbyentropy$age.years.c <- scale(study3_switchbyentropy$age, scale = FALSE)[,1]


study3_SwitchEnt_model <- lme4::glmer(
  shipibo_response ~ age.years.c + Entropy + (1|subj),
  data=study3_switchbyentropy, family = "binomial")

study3_SwitchEnt_model_original <- lme4::glmer(
  shipibo_response ~ age.years.c * Entropy + (1|subj),
  data=study3_switchbyentropy, family = "binomial")

# apa_table(apa_print(study3_SwitchEnt_model)$table)

```

```{r study2-overextensions}


study2_adjacentorswitch_whole <- study2_prod_data %>%
  group_by(subj, age) %>%
  filter(response_order %in% c("first", "only")) %>%
  mutate(correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent),
         correct_all = ifelse(correct + correct_either + correct_nearby > 0, 1, 0)) %>%
  select(subj, age, prompt, wrong_adjacent, starts_with("correct")) %>%
  gather(key = "measure", value = "score", starts_with("correct")) %>%
  mutate(measure = factor(gsub("_","",measure)))

study2_adjacentorswitch_whole$age.years.c <- scale(study2_adjacentorswitch_whole$age, scale = FALSE)[,1]

study2_adjacentorswitch <- study2_adjacentorswitch_whole %>%
  group_by(subj, age, age.years.c, measure) %>%
  summarise(score = mean(score), .groups = 'drop')

study2_AdjSwitchModel <- lme4::glmer(
  score ~ age.years.c * measure + (1 | subj) ,
  data=study2_adjacentorswitch_whole, family = "binomial")

study2_adjacentbyentropy <- study2_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID")) %>%
  mutate(wrong_adjacent = ifelse(is.na(wrong_adjacent), 0, wrong_adjacent))

study2_adjacentbyentropy$age.years.c <- scale(study2_adjacentbyentropy$age, scale = FALSE)[,1]

study2_AdjacEnt_model <- lme4::glmer(
  wrong_adjacent ~ age.years.c + Entropy + (1|subj),
  data=study2_adjacentbyentropy, family = "binomial")

# apa_table(apa_print(study2_AdjacEnt_model)$table)


```

```{r study3-overextensions}
study3_adjacentorswitch_whole <- study3_prod_data %>%
  group_by(subj, age, gender) %>%
  filter(response_order %in% c("first", "only")) %>%
  mutate(correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent),
         correct_all = ifelse(correct + correct_either + correct_nearby > 0, 1, 0)) %>%
  select(subj, age, gender, starts_with("correct")) %>%
  gather(key = "measure", value = "score", starts_with("correct")) %>%
  mutate(measure = factor(gsub("_","",measure)))

study3_adjacentorswitch_whole$age.years.c <- scale(study3_adjacentorswitch_whole$age, scale = FALSE)[,1]

study3_adjacentorswitch <- study3_adjacentorswitch_whole %>%
  group_by(subj, age, age.years.c, gender, measure) %>%
  summarise(score = mean(score), .groups = 'drop') 

study3_AdjSwitchModel <- summary(lme4::glmer(
  score ~ age.years.c + measure + (1|subj),
  data=study3_adjacentorswitch_whole, family = "binomial"))

study3_adjacentbyentropy <- study3_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID")) %>%
  mutate(wrong_adjacent = ifelse(is.na(wrong_adjacent), 0, wrong_adjacent))

study3_adjacentbyentropy$age.years.c <- scale(study3_adjacentbyentropy$age, scale = FALSE)[,1]

study3_AdjacEnt_model <- lme4::glmer(
  wrong_adjacent ~ age.years.c + Entropy + (1|subj),
  data=study3_adjacentbyentropy, family = "binomial")

study3_AdjacEnt_model_noage <- lme4::glmer(
  wrong_adjacent ~ Entropy + (1|subj),
  data=study3_adjacentbyentropy, family = "binomial")

```


```{r comp-childfigure, fig.height = 9.5, fig.cap = "(A and B) A comparison of children's performance during the comprehension tasks in Studies 2 (top) and 3 (bottom). Solid or dotted lines represent overall performance by age for a particular chip. Solid lines show whether the child chose the correct chip when prompted with a color term; dotted lines show whether a child chose the correct chip or a chip from an adjacent color category. Line colors are representative of the label’s prototypical color coordinates."}

study23_overallcomp <- raw_data %>% 
  filter(task == 'Comprehension') %>% select(-correct_either) %>%
  rename(study = language) %>% mutate(
    study = case_when(
      study == "Shipibo" ~ "Study 2",
      study == "Spanish" ~ "Study 3"),
    correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent)) %>%
  group_by(study, age, prompt) %>%
  gather(key = "criteria", value = "score", 
         starts_with("correct")) 

plot_compaccuracyvsage <- function(df) {
  
  df_correct <- filter(df, criteria == "correct") %>%
    group_by(study, age_interval, prompt, criteria) %>%
    summarise(score = mean(score, na.rm = T), .groups = 'drop')
  
  compaccuracyvsage_plot <- ggplot(df, aes(x = age_interval, y = score, colour = prompt,
                           group = criteria, linetype = criteria)) +
  geom_jitter(data = df_correct,
    alpha = .25, width = .3, height = .1, col = "gray") + 
  geom_smooth(se = FALSE, method = "loess", span = 1) +
  facet_wrap(~ prompt, scales = "free", ncol = 3) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
  xlim(c(5,11.5)) +
  scale_color_manual(values = graph_colors, guide = FALSE) +
  scale_linetype_manual(values = graph_lines, guide = FALSE) +
  labs(x = "Age", y = "Proportion of Correct Responses", 
       linetype = "Measure", colour = "Color Term") +
  guides(label = "none") +
  theme(legend.position = "none", strip.text = element_text(face = "bold", size = 9))
  
  return(compaccuracyvsage_plot)
}

comp_accuracyvsage_2 <- plot_compaccuracyvsage(filter(study23_overallcomp, study == "Study 2"))

comp_accuracyvsage_3 <- plot_compaccuracyvsage(filter(study23_overallcomp, study == "Study 3"))

comp_childfigure <- plot_grid(
  comp_accuracyvsage_2 + theme(axis.title.x = element_blank()), 
  comp_accuracyvsage_3, 
  labels = c("A", "B"), ncol = 1, rel_heights = c(3,4)
  )

# print(comp_childfigure)

```

```{r study2-overallcomp-models}
study2_overallcomp <- study23_overallcomp %>% filter(study == "Study 2")

study2_overallcomp$age.years.c <- scale(study2_overallcomp$age, scale = FALSE)

## Doesn't converge but study2_firstprod_either and study2_firstprod_adjacent do?
study2_overallcomp_same <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study2_overallcomp, criteria == "correct"), 
      family = "binomial")

study2_overallcomp_adjacent <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study2_overallcomp, criteria == "correct_nearby"), 
      family = "binomial")
```

```{r study3-overallcomp-models}
study3_overallcomp <- study23_overallcomp %>% filter(study == "Study 3")

study3_overallcomp$age.years.c <- scale(study3_overallcomp$age, scale = FALSE)

study3_overallcomp_same <- glmer(score ~ age.years.c  + (1 | prompt) + (1 | subj), 
      data = filter(study3_overallcomp, criteria == "correct"), 
      family = "binomial")

study3_overallcomp_adjacent <- glmer(score ~ age.years.c  + (1| prompt) + (1 | subj), 
      data = filter(study3_overallcomp, criteria == "correct_nearby"), 
      family = "binomial")
```

```{r study23-accuracy, fig.cap = "Proportion of accurate responses when applying different accuracy criteria, by age and study. Points show the mean for a 2-year age group (chosen arbitrarily for visualization) with 95% confidence intervals. Lines show a linear fit, weighted by the number of datapoints in each age group."}

study23accuracyplots_prod_plot <- bind_rows(list("Production: SK" = study2_adjacentorswitch, 
                 "Production: Spanish" = study3_adjacentorswitch), .id = "study") %>%
  mutate(measure = fct_collapse(measure,
                      "Exact" = c("correct"),
                      "Either Language" = c("correcteither"),
                      "Adjacent Color" = c("correctnearby"),
                      "Either + Adjacent" = c("correctall"))) %>%
  mutate(age = floor((age+1)/2)*2-1) %>%
  group_by(study, age, measure) %>% 
  summarise(n = n_distinct(subj),
            ci = qt(0.975, df=n-1)*sd(score)/sqrt(n), 
            score = mean(score), .groups = 'drop') %>%
  ggplot(aes(x = age, y = score, color = measure, group = measure)) +
  facet_grid(. ~ study) +
  geom_point(aes(size = n), alpha = .5,
             position = position_dodge(width = .1)) + 
  geom_linerange(aes(ymin = score - ci, ymax = score + ci), 
                 position = position_dodge(width = .1))+ 
  geom_smooth(method = "lm", aes(weight = n), se = FALSE) + 
  labs(x = "Age", y = "Proportion", 
       fill = "Accuracy", color = "Accuracy", size = "# of Subjects") +
  ggthemes::scale_color_ptol() +
  coord_cartesian(ylim = c(0,1)) + 
  theme_apa() +
  theme(legend.position = "right") 

study23accuracyplots_comp_plot <- study23_overallcomp %>% ungroup() %>%
  mutate(measure = fct_collapse(criteria,
                      "Original" = c("correct"),
                      "Adjacent Color" = c("correct_nearby"))) %>%
  mutate(age = floor((age+1)/2)*2-1, 
         study = ifelse(study == "Study 2", "Comprehension: SK", "Comprehension: Spanish")) %>%
  group_by(study, age, measure) %>% 
  summarise(n = n_distinct(subj),
            ci = qt(0.975, df=n-1)*sd(score)/sqrt(n), 
            score = mean(score), 
            .groups = 'drop') %>%
  ggplot(aes(x = age, y = score, color = measure, group = measure)) +
  facet_grid(. ~ study) +
  geom_point(aes(size = n), alpha = .5,
             position = position_dodge(width = .1)) + 
  geom_linerange(aes(ymin = score - ci, ymax = score + ci), 
                 position = position_dodge(width = .1))+ 
  geom_smooth(method = "lm", aes(weight = n), se = FALSE) + 
  labs(x = "Age", y = "Proportion", size = "# of Subjects",
       fill = "Accuracy", color = "Accuracy") +
  ggthemes::scale_color_ptol() +
  coord_cartesian(ylim = c(0,1)) + 
  theme_apa() 

study23accuracy_plots <- plot_grid(
  plot_grid(
    study23accuracyplots_prod_plot +
      theme(axis.title.x = element_blank()) +
      theme(legend.position = "none"),
    study23accuracyplots_comp_plot +
      theme(legend.position = "none"),
    labels = c("A", "B"), ncol = 1, rel_heights = c(3.5,4), rel_widths = c(1,1)
  ),
  get_legend(study23accuracyplots_prod_plot), nrow = 1, rel_widths = c(1, 0.3))

print(study23accuracy_plots)


```




## Results and Discussion

We begin by presenting general results from both the production and comprehension tasks, and then turn to specific analyses of overextensions. Figure \@ref(fig:study23-accuracy) shows general trends across measures. For Study 2, we saw robust developmental increases in both production and comprehension. Because we had limited expectations regarding the amount of data that would be gathered during visits to the SK, we did not preregister our analyses. Thus all reported inferential statistics should be interpreted with some caution, and we do not adopt a specific cutoff of $\alpha = .05$ for interpretation. 

To quantify these trends, we fit generalized linear mixed-effects models (GLMMs) predicting accuracy for both production and comprehension tasks with fixed effects of age in years (centered), random slopes of age for each color, and random intercepts for each color and participant. When these models failed to converge, we removed random slopes. We found highly significant age effects for both production (`r apa_print(study2_firstprod_same)$full_result$age_years_c`) and comprehension (`r apa_print(study2_overallcomp_same)$full_result$age_years_c`). Most children in our study knew some SK color words, but few except some of the oldest children knew all of them. 

```{r study2-task-compare-plot, fig.cap = "Production and comprehension data for selected color chips, plotted by age group."}


study2_task_compare <- study23_firstprod %>%
  bind_rows(study23_overallcomp) %>% 
  filter(study == "Study 2" & 
         spanish %in% c("Amarillo", "Blanco", "Morado", "Negro") &
           criteria == "correct") %>%
  mutate(task = factor(task, levels = c("Production", "Comprehension")),
         prompt = forcats::fct_collapse(spanish,
                    `Joxo - n°274` = c("Blanco"),
                    `Wiso - n°312` = c("Negro"),
                    `Panshin - n°297` = c("Amarillo"),
                    `Ami/Poa - n°325` = c("Morado")))

study2_task_compare_plot <- study2_task_compare  %>%
  group_by(age_interval, task, prompt, spanish) %>%
  summarise(correct = mean(score),
            n = n(),
            .groups = 'drop') %>%
  ggplot(., aes(x = age_interval, y = correct, group = task, col = task)) +
  geom_line() + 
  geom_point() + 
  facet_wrap(~ prompt, scales = "free") +
  ggthemes::scale_color_ptol() +
  scale_x_continuous(limits = c(4.5,11.5), breaks = 5:11) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) +
  labs(x = "Age", y = "Proportion of Correct Responses", fill = "Task") +
  theme_apa() +
  theme(legend.position = "bottom") 

print(study2_task_compare_plot)
```

### Production vs. comprehension

While overall, production and comprehension accuracies were quite close, there were exceptions. For some term-chip pairings such as "ami/pua" and "pei/xo", children failed to produce the correct term in the production task but performed substantially better during the comprehension task (Figure \@ref(fig:study2-task-compare-plot)). While there was a consistent ordering of tasks (production always first), there was no feedback on the production task, thus we think it is unlikely that children learned (or remembered) these labels as a function of task order. More likely is that these labels are relatively lower frequency and some children recognized them despite being unable to produce them. 

### Age of Acquisition

Following @frank2020, we used the dichotomous responses given during the production task to predict the "age of acquisition" when at least half of SK children are predicted to properly label a particular chip. First, we split responses by the prompted chip for which each participant had a single entry. For each chip, we attempted to fit a generalized linear model by robust methods [@R-robustbase] with the structure `accuracy of response [0 or 1] ~ age`. The coefficients for age ranged from `r round(min(study2_prod_predict_aoa$coef_age, na.rm=T),2)` (odds of success multiplied by $\exp{(\hat{\beta})}$ = `r round(exp(min(study2_prod_predict_aoa$coef_age, na.rm=T)),1)` with every added year of age) to `r max(study2_prod_predict_aoa$coef_age, na.rm=T)` (odds multiplied by $\exp{(\hat{\beta})}$ = `r round(exp(max(study2_prod_predict_aoa$coef_age, na.rm=T)),1)`). To find age of acquisition then predicted the probability of success for the range of participant ages, `r min(study2_firstprod$age)`- to `r max(study2_firstprod$age)`-years-old at increments of 0.05 years, and selected the earliest age at which the accuracy crossed 0.5. 

Using this method, we predict that half of SK children first learn to label the "joxo" chip (white) at `r study2_prod_predict_aoa %>% filter(aoa == min(aoa)) %>% pull(aoa)` years of age. This is followed by the "wiso" chip (black) at `r study2_prod_predict_aoa %>% filter(prompt == "312") %>% pull(aoa)`, the "hoshin" chip (red) at `r study2_prod_predict_aoa %>% filter(prompt == "245") %>% pull(aoa)`, the "panshin" chip (yellow) at `r study2_prod_predict_aoa %>% filter(prompt == "297") %>% pull(aoa)`, the "yankon" chip (green) at `r study2_prod_predict_aoa %>% filter(prompt == "234") %>% pull(aoa)`, the "nai" chip (sky-blue; "yankon" also accepted) at `r study2_prod_predict_aoa %>% filter(prompt == "1") %>% pull(aoa)`, and the "yankon"/"joshin" chip (greenish-yellow) at `r study2_prod_predict_aoa %>% filter(prompt == "320") %>% pull(aoa)`. The model for one chip ("purple") did not predict that age of acquisition would have been met within our age range, with an estimated probability of `r 100*round(study2_prod_predict %>% filter(prompt == "325") %>% filter(age == 11.5) %>% pull(fit),2)`% of children successfully labelling at 11.5 years of age.^[It is worth noting that in Study 1, adult participants used 7 different labels for this chip (`r pander::p(study1_consensus %>% filter(.data[["Chip ID"]] == 325 & !is.na(.data[["Color Term"]])) %>% pull('Color Term') %>% tolower, wrap = "*", copula = ", and ")`), none of which were used more than 25% of the time.] 

Our predictions suggest that SK children obtain color term knowledge at notably older ages compared to children in the United States [@wagner2013]. Further, the ordering of acquisition is substantially different from that attested in previous studies. It is an interesting question what properties of children's input or the color terms themselves lead to this order of acquisition. Following @yurovsky2015, we might speculate about the potential that "joxo" is substantially higher frequency in SK than "white" is in English. 

### Language switching

Over a quarter (`r study2_switchperc$overall_response[1]`%) of all responses were given in Spanish, despite children being prompted solely in SK (i.e., labeling a *panshin* chip as "amarillo"). The distribution of Spanish responses was non-random, with median use in `r median(study2_overallswitch$n_spanish)`/8 trials (*IQR* = `r paste0(quantile(study2_overallswitch$n_spanish, c(0.25, 0.75)), collapse = "-")`). We did not find a significant correlation between age and number of trials with Spanish-language responses throughout the production task (`r apa_print(study2_overallswitch_test)$statistic`).

```{r study1-entropy-table, results='asis'}
apa_table(study1_selectedchips_table,
         caption = "Naming entropy by color chip and whether the chip was used in Study 2 and Study 3." )
```

As a further exploratory analysis, we attempted to quantify low naming consensus using naming entropy [following @gibson2017]. We computed the naming entropy for each chip by computing the probabilities for each chip $c$ to be named with a particular label $l$ ($p(l \mid c)$) and then taking $H(c) = -\sum_{l}{p(l\mid c) \log[p(l \mid c)]}$ (see inset entropy values by chip in Table \@ref(tab:study1-entropy-table)).
To assess the hypothesis that naming entropy in adults was related to Spanish use in children, we fit a GLMM to predict likelihood of switching languages from SK to Spanish (a binary variable) as a function of child age, entropy of the chip's naming distribution for adults in Study 1, and their interaction (as well as random effects of subject). Despite age not being very correlated with overall frequency of Spanish responses, within this model, we found that overall older children tended to be less likely to respond in Spanish (`r apa_print(study2_SwitchEnt_model)$full_result$age_years_c`), perhaps due to greater knowledge of SK terms. Children were also more likely to respond in Spanish when presented with a chip with high entropy (low naming consensus) among adult participants in Study 1 (`r apa_print(study2_SwitchEnt_model)$full_result$Entropy`). We further found some evidence of a positive interaction between age and entropy (`r apa_print(study2_SwitchEnt_model)$full_result$age_years_c_Entropy`), suggesting more  Spanish responding for older children specifically for those chips with high adult uncertainty. Together these findings suggest that older children show an increasingly adaptive use of Spanish vocabulary to describe chips for which there is not community consensus among adults.   

### Overextensions

One reason to use Spanish would be if children fail to recall the proper SK color term but do know the proper mapping in the Spanish. But another possibility is that children may have more imprecise representations and choose to respond with a same-language but adjacent color term (i.e., labeling a *panshin*-colored chip as "joshin"). Following @wagner2013, we aggregated across color chips and examined the pattern of children's first responses, categorizing them as same-language, adjacent, and different-language. We used a GLMM to assess whether calculated word entropy and age were associated with frequency of adjacent responses. We predicted the outcome using fixed effects of age in years (centered) and entropy, with random effects of participant.  We found that younger children were more likely to respond with SK-language adjacent terms (`r apa_print(study2_AdjacEnt_model)$full_result$age_years_c`)  but chip entropy did not predict this strategy (`r apa_print(study2_AdjacEnt_model)$full_result$Entropy`). Further, coefficients in this model were almost identical to the coefficient for strict scoring, confirming the impression that these overextensions were relatively rare compared to the use of Spanish terms. 

<!-- If children fail to recall the proper color term in SK, but do know the proper mapping in the Spanish color system, language-switching may be an appropriate strategy. Should they lack knowledge of the corresponding Spanish color term, they may also choose to respond with an adjacent same-language color term. If we allow for more leniency in scoring -- accepting adjacent same-language and different-language responses -- we can check for more subtlety surrounding color term mapping (Figure \@ref(fig:study23-accuracy)). In order to assess if changes in our scoring criteria would lead to significant changes in accuracy, we modified our original accuracy GLMM to include an interaction between age and different scoring criteria (same-language/adjacent,different-language/corresponding, and combined) which led to the following structure: accuracy of response [0-1] ~ age in years * scoring criteria + (age | prompt) + (1 | subject). We found a significant improvement in accuracy scores when we allowed different-language but corresponding responses (`r apa_print(study2_firstprod_all)$full_result$criteriacorrect_either`) but no significant change when allowing for same-language but adjacent responses (`r apa_print(study2_firstprod_all)$full_result$criteriacorrect_nearby`). This increase in accuracy with language-switching strengthened with age (`r apa_print(study2_firstprod_all)$full_result$age_years_c_criteriacorrect_either`).  -->


# Study 3

Noting the apparent strategy of language switching seen in Study 2, we designed Study 3 as its complement. Here, we tested children’s production and comprehension of Spanish color terms with a similar protocol to Study 2 but with a subset of chips representing prototypical colors for the Spanish color system. 

## Methods

### Participants

We recruited a separate sample of `r study3_participants$num_total` children (`r study3_participants$num_boys` boys) ages `r study3_participants$min_age`- to `r study3_participants$max_age`-years-old from the neighborhood of Bena Jema in Yarinacocha and from Bawanisho. Recruitment occurred either through interested parents or a local school. As in Study 2, we received consent from parents and, if in a school environment, teachers as well.

### Materials and procedure

Based on Study 1, we selected 11 color chips to serve as prototypical instances of prominent Peruvian Spanish color terms. These color chips included 6 also used during Study 2: green (n°234), red (n°245), white (n°274), yellow (n°297),  black (n°312) , and purple (n°325). Five additional chips were selected: gray (WCS n°46), pink (n°65), orange (n°121), brown (n°266), and blue (n°291) (see Appendix 1). The blue chips differed between Studies 2 and 3 as we decided that the prototypical hues for *yankon* and *azul* differed enough to warrant the use of a different chip.

As we found that many SK children in our sample were not very fluent in Spanish -- despite receiving some school instruction in Spanish -- the production and comprehension tasks were both conducted in SK, and Spanish was only used for color terms (i.e., Spanish color terms were embedded within otherwise SK sentences). In both tasks, a participant would sit at a table across from the experimenter with 11 color chips in front. As in Study 2, the production task was always performed prior to the comprehension task.

## Production task

The procedure was similar to that of both Studies 1 and 2. The experimenter would introduce a participant to the general procedure and aims of the study. Despite much of the study being conducted in SK, the experimenter would specify that participants would be expected to provide color terms in Spanish. The experimenter would then ask: "What is the color of this chip?". If the participant responded in SK, the experimenter would record their response but further ask: "What is the name of this color in Spanish?". If a participant responded with "I don’t know" to this prompt, the experimenter would not prompt any further and would move forward to the next chip. As a result, some responses lack Spanish-language BCTs and only consist of non-basic and/or SK color terms. In total, we collected production data for 11 color chips. For each chip, the data include either one response (when children provided a Spanish basic color term in the first trial) or two or three responses (when children’s initial responses were either non-basic and/or in SK).

### Comprehension task

The procedure was similar to that of Study 2. The experimenter would ask: Can you give me the [*color term*] chip? For 11 Spanish color terms. The choice of these terms was based on both previous studies examining Spanish color terms as well as responses given by adult participants in Study 1 (as some adult participants used Spanish color terms to label particular color chips). The 11 terms used as prompts were "blanco" (white), "verde" (green), "rojo" (red), "amarillo" (yellow), "azul" (blue), "negro" ("black"), "naranja" (orange), "gris" (gray), "morado" (purple), "marrón" (brown), and "rosa" (pink). Since each color term was best instantiated by a single color chip and lacked the ambiguity seen with certain SK color terms, we defined a correct response as choosing the single color chip that matched the word, in contrast to Study 2.

## Results and Discussion

As in Study 2, we observed age-related changes in color term accuracy for both production and comprehension. Aggregate results are visualized in \@ref(fig:study23-accuracy). To assess these, we again fit GLMMs for both production and comprehension tasks with an identical structure to Study 2. Age was a significant predictor of accuracy in the comprehension task (`r apa_print(study3_overallcomp_same)$full_result$age_years_c`), but the age effect was weaker in the production task (`r apa_print(study3_firstprod_same)$full_result$age_years_c`, see Figure \@ref(fig:study23-accuracy)). 

Similar to Study 2, over a quarter (`r study3_switchperc$overall_response[1]`%) of all responses were given in SK, despite being prompted to respond in Spanish. There was significant variation in language-switching with some children responding solely in Spanish while others responded to upwards of `r max(study3_overallswitch$n_shipibo)`/11 trials in SK (*Mdn* = `r median(study3_overallswitch$n_shipibo)` trials, *IQR* = `r paste0(quantile(study3_overallswitch$n_shipibo, c(0.25, 0.75)), collapse = "-")`). We found only a marginal correlation between age and accuracy (`r apa_print(study3_overallscore_test)$statistic`) and no significant correlation between age and language-switching (`r apa_print(study3_overallswitch_test)$statistic`). 

To assess to our hypothesis that older children would have more Spanish-language exposure and color term knowledge, we included age as a predictor in our GLMM assessing the effect of adult color naming entropy on likelihood to switch languages from Spanish to SK, similar to the one we fit for Study 2. This model did not show a significant interaction between age and adult color naming entropy (`r apa_print(study3_SwitchEnt_model_original)$full_result$age_years_c_Entropy`), however one without the interaction term did show an entropy effect (`r apa_print(study3_SwitchEnt_model)$full_result$Entropy`), tending to respond in SK for low-entropy items (those that were presumably more prototypical for the SK words). There was no significant effect of age (`r apa_print(study3_SwitchEnt_model)$full_result$age_years_c`). Across studies, it appears that children preferred to respond in SK when presented with a chip for which adults had high consensus about the SK label, and in Spanish for low-consensus chips.

Similar to Study 2, we adopted alternative scoring to accommodate language-switching from Spanish to SK (different-language) and adjacent same-language responses. We used a GLMM identical to that of Study 2 in order to assess if changes in scoring criteria were associated with significant changes in task performance for production. Age was again a weaker predictor for production accuracy even with this more lenient scoring (`r apa_print(study3_firstprod_all)$full_result$age_years_c`), in concordance with earlier analyses. However, we did find that participants had higher aaccuracy when we includedSK responses (`r apa_print(study3_firstprod_all)$full_result$criteriacorrect_either`) or adjacent same-language  responses (`r apa_print(study3_firstprod_all)$full_result$criteriacorrect_nearby`). In sum, we find frequent use of language switching in both Studies 2 and 3, but only Study 3 exhibits significant use of same-language but adjacent terms. 
<!-- NEED TO TEST DIFFERENCE IN SCORE BETWEEN ADJACENT AND EXACT -->

We speculate that early, informal Spanish language exposure can explain the discrepancies seen in Studies 2 and 3. With limited knowledge of Spanish color terms, children may spontaneously supplement their color term knowledge with Spanish terms during SK-language Study 2 but struggle to succeed in a more systematic evaluation in Study 3. More generally, we see children relying on a mixture of strategies to communicate colors even in the absence of mastery in either language. 

# General Discussion

In three studies, we mapped the color vocabulary of the Shipibo-Konibo (SK) language and used these data to study the development of color vocabulary in SK children growing up in a bilingual environment. This effort fills a gap in studies of color word development in non-WEIRD cultures and more generally parallels other efforts to use methods from language development to study populations that are under-represented in developmental science [e.g., @piantadosi2014; @fortierunderreview]. 

With respect to the adult data, we found that the SK color vocabulary was relatively unchanged over the generations since the original WCS. Several interesting observations emerged, however. First, there was substantial use of Spanish terms, even though the task was conducted in SK, likely because the adults were recognizing focal colors for Spanish BCTs that have no parallel in SK (e.g., "naranja" for orange). This finding suggests an adaptive use of color vocabulary from both languages to succeed on the labeling task; future work will be required to understand whether such strategies are used in naturalistic communication as well. Second, we noted substantial use of ad hoc color terms (including luminance terms). These terms were used more often in SK than in Spanish, supporting the idea that Amazonian languages may make greater use of ad hoc color terms (at least in naming tasks) than Spanish speakers [e.g., @everett2005]. Our data do not speak to whether this use is due to a desire to succeed on specific experimental tasks or whether it is comparable to use in naturalistic contexts. Nevertheless our findings are reminiscent of a suggestion by @levinson2000 that even purported BCTs in Yélî Dnye did not fully span hue space and were often supplemented creatively with ad hoc terms.

When we turned to the children’s data, we observed a much longer developmental trajectory for color than is observed in modern US English-learning children. As noted by @bornstein1985, however, it is a very recent development that color terms are mastered as early as they are --z one hundred years ago, English-speaking US children’s timeline of acquisition looked broadly similar to that observed in our study for SK children. We can only speculate as to the drivers of this historical change, but the industrialization hypothesis propounded by @gibson2017 appears to be a reasonable starting point. That is, industrialization allows for the production of identical objects that are usefully distinguished by color labeling. This communicative pressure can then lead to differentiation of color terms on a historical timescale and – relevant to our study here – is a likely driver of faster acquisition of color words by children.^[These speculations are informed by personal experience; the children of one author both learned their color terms in their second year through repeated practice with sets of manufactured plastic artifacts that varied only in hue, providing ideal teaching examples.]

We did not find strong evidence for overextension in children’s SK production or comprehension (with one or two exceptions), though there was somewhat more evidence for overextension in Spanish. This asymmetry might be due to less systematic or consistent exposure to Spanish vocabulary, but this explanation is merely speculative. We did, however, observe robust evidence for mixing and competition between the SK and Spanish color systems. Children differentially used Spanish terms in Study 2 when there was high uncertainty about the SK label for a particular color chip among adults. Similarly, they reached into their SK vocabulary in Study 3 when there was high consistency in SK labels among adults. These findings suggest that children were using their bilingual vocabulary adaptively to choose terms that are more likely to be interpreted correctly. Further, they suggest a potential route for functionally-driven language change, such that Spanish terms are borrowed – and perhaps eventually conventionalized – by children in cases where adult input data indicate uncertainty about the appropriate SK label. 

Comprehension is generally thought to proceed production in language development generally [@frank2020; @clark2009] and in color word learning specifically [@wagner2018]. In our data we did not observe large asymmetries between comprehension and production. Yet this result comes with caveats. First, comprehension and production tasks are by their nature different and have different demands [@sandhofer1999]; this was especially true in our case given that the two tasks were sequenced and scored somewhat differently. Thus, we have chosen not to make quantitative comparisons between accuracies across these two tasks. Second, production and comprehension may be especially divergent for the youngest children, those who have the most difficulty with phonological encoding and the motoric aspects of production [@frank2020]; there is less evidence for production-comprehension divides in middle childhood. One natural question is whether comprehension and production dissociated in earlier times when US English-learners similarly acquired colors late; unfortunately we do not know of data that could be used to evaluate this question.

Our data here are consistent with models of color word meaning in which color word use is driven by functional need and languages adapt by developing vocabularies that appropriately allow for communication about those needs [@gibson2017; @zaslavsky2018]. These models have not yet been generalized to either the bilingual setting or the acquisition setting, however. Our data suggest that functional language use can cross language boundaries, inviting models that consider code switching and borrowing as part of the process of change [e.g., @myslin2015].

Studying SK children's learning provides a descriptive comparison to studies of color naming in children learning English in the US (the focus of the majority of developmental work). Nonetheless, it has a number of limitations, some shared with this previous literature and some due to the specifics of our study and context. First, we regrettably do not have access to the kind of deep ethnographic observations that would allow us to hazard generalizations about how color terms are used in daily life among the SK communities we studied. Second, our study of development is cross-sectional and does not afford precision regarding the specific knowledge state of individual children due to the limited length of the task. Third, the limited number of color chips that we investigated means that our ability to generalize about the precision of particular color generalizations is much more limited for the children than the adults (limiting our entropy analyses). Finally, and perhaps most prominently, the kinds of tasks that we used are likely more unfamiliar to all of our participants and especially our child participants than they are to the populations being tested in investigations of WEIRD cultures (e.g., US English-learning children). While the performance of the oldest children in our studies was close to ceiling, the lower performance observed with younger children could in principle be in part a product of task unfamiliarity or other factors. 

Going beyond convenience populations in experimental research with children is a new frontier for developmental science [@nielson2017]. Our work here suggests some of the benefits and challenges of this approach. On the positive, we can compare and generalize models of acquisition that are largely based on a single language and population (US English-acquiring children). At the same time, there is a paucity of resources describing language use, home environment, and cultural practices once we venture outside of WEIRD contexts. To best understand acquisition across cultures, we must document both children’s knowledge and the structure of their environments. 



\newpage

# References

```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
