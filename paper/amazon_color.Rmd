---
title             : "The Development of Color Terms in Shipibo-Konibo Children"
shorttitle        : "Color Terms in Shipibo-Konibo Children"

author: 
  - name          : "Danielle Kellier\\*"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "danielle.kellier@pennmedicine.upenn.edu"
  - name          : "Martin Fortier\\*"
    affiliation   : "2"
  - name          : "Maria Fernández Flecha"
    affiliation   : "3"
  - name          : "Michael C. Frank"
    affiliation   : "4"

affiliation:
  - id            : "1"
    institution   : "University of Pennsylvania"
  - id            : "2"
    institution   : "PSL Research University"
  - id            : "3"
    institution   : "Pontificia Universidad Católica del Perú"
  - id            : "4"
    institution   : "Stanford University"

author_note: |
  \* these authors contributed equally. 
  
  MCF was supported by a Jacobs Foundation Fellowship. We are especially grateful to Paul Kay for assistance throughout the study.

abstract: |
  Enter abstract here. Each new line herein must be indented, like this line.
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

figsintext        : yes
figurelist        : no
tablelist         : no
footnotelist      : no
lineno            : yes
mask              : no

always_allow_html : yes
class             : "man"
output            : papaja::apa6_pdf
---

```{r load-packages, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, warning = FALSE, error = FALSE, 
                      message = FALSE, sanitize = TRUE)
library("papaja")

library(tidyverse)
library(DT)
library(ggthemes)
library(cowplot)
library(viridis)
library(english)
library(lme4)
library(nnet)
library(here)

```

```{r analysis-preferences}
source(here("helpers/load_and_process.R"))

set.seed(42) # Seed for random number generation

theme_set(theme_bw() + 
            theme(strip.background = element_blank(), 
                  panel.grid = element_blank())) # nice theme with limited extras

raw_data <- feather::read_feather(here("intermediates/processed_data.csv"))

```


TO BE PASTED FROM GOOGLE DOC

# Introduction

Color language is where language and perception meet. Terms like *blue* or *red* draw boundary lines across a perceptually continuous space. In English, there are 11 basic color terms, but this color categorization is not universal. For instance, Russian speakers use two distinct words to describe the colors light blue (“goluboy”) and dark blue (“siniy”); and some languages have as few as two words [e.g., the Jalé people only have terms for “light” and “dark”; @berlin1969]. Why do languages vary in their color systems? One emerging consensus is that languages categorize the color spectrum in different ways in part due to functional demands [@gibson2017]: both smaller and larger color systems are relatively optimal for suiting different communicative needs [@regier2007]. 

One important component of this hypothesis is the idea that some color systems are easier to learn for children than others; but the actual acquisition of color terms – while well-studied in English [e.g., @wagner2013] – is extremely under-studied across other populations. Berlin & Kay’s seminal World Color Survey [WCS; @berlin2009] presented adult speakers of over 100 languages with differently colored chips and asked them to produce a label, characterizing the space of color vocabulary in a range of written and unwritten languages. The WCS is an invaluable resource for the cross-linguistic study of color vocabulary, but no comparable resource exists for cross-cultural studies of how this vocabulary is learned across childhood. 

In the current project, our goals were (1) to characterize color term knowledge in an indigenous population previously studied by the WCS, the Shipibo-Konibo (SK), and then (2) to build on this foundation to characterize the developmental trajectory of color language acquisition in a group of children raised outside of the WEIRD (Western Educated Industrialized Rich Democratic) populations that are over-represented in behavioral science. 

## Color in Amazonian languages and Latin American varieties of Spanish

A few studies explore the use of color terms in the varieties of Spanish in Latin America. @berlin1969 examine the case of the Mexican dialect of Spanish, which they consider to be in Stage VII of their classification. So, for example, a Stage II system would add the term red to the colors already present in Stage I (*black* and *white*). It wouldn't be possible for a system to have *red* if it doesn't already have *black* and *white*. They identify the following basic color terms: *blanco* (white), *negro* (black), *rojo* (red), *verde* (green), *amarillo* (yellow), *azul* (blue), *café* (brown), *morado* (purple), *rosa* (pink), *anaranjado* (orange) and *gris* (grey). Also, based on their work with forty Tzeltal participants, both Tzeltal monolinguals as well as Tzeltal-Spanish bilinguals, they found that bilingualism did not skew their results regarding the existence of semantic universals in the domain of color vocabulary. Tzeltal has five basic color terms:  *?ihk´* (black), *sak* (white), *cah* (red), *yaš* (green) and *k´an* (yellow). This language is estimated to be transitioning from Stage IV to V, which is reflected in the ambiguity of the focus of *yaš* (grue). The authors posit that a long history of contact with Spanish has probably accentuated this, and suggest that exposure to Spanish in schools will eventually cause *yaš* to be entirely restricted to greens, and *azul*  (or some other Spanish term) will be adopted into the Tzeltal color system.

@monroy1989 offers information on Colombian Spanish based on materials collected for the Linguistic-ethnographic Atlas of Colombia. He presents examples of ad hoc color terms referring to colors through objects prototypically instantiating these color: "vegetables", "animals", "food", "metals", "precious stones", "fire and its derivatives" and "atmospheric phenomena".

More recently, @aragon2016 offers an ethnolinguistic study of color terms in Mexican Spanish: *amarillo* (yellow), *azul* (blue), *blanco* (white), *café* (literally “coffee”, but effectively brown), *gris* (gray), *morado* (purple), *naranja* (orange), *negro* (black), *rojo* (red), *rosado* (pink) and *verde* (green). She analyzes the elaboration of these meanings in dictionaries, as well as the references and associations to which informants resort to for their own definitions. Aragón concludes that the local natural and cultural referents constitute a point of consensus among Mexicans when defining terms of color. Although informants also discussed some cultural material referents, these were not salient prototypes in their explanations. A special case that would merit further study in the future is that of *café* in Mexico versus *marrón* in Spain. According to the author, these two color terms are differentiated by the prototype "toasted coffee grain” associated to the Mexican Spanish term. Finally, she reviews the symbolic associations related to some terms, such as the discourses on femininity, especially those centered around the figure of the girl, associated with the term *rosado.*

@gibson2017 offer some approximations to the case of color terms in Bolivian Spanish, based on their analysis centered on Tsimane, an indigenous language spoken by a group living in the Amazonian piedmont. The authors compare the Tsimane case with Bolivian Spanish and American English. Compared to Bolivian Spanish and English, Tsimane exhibits greater variability in terms of the color terms used for all color chips presented in their study, with the exception of red. Out of a total of 80 color chips, Tsimane exhibits 8 modal color terms while English has 10, and Bolivian Spanish, 11. Also, despite the variability observed, the assignment of modal color terms resulted in a similar partition of the color space in the three languages assessed. The authors also emphasize that the Tsimane color system is less informative than the English and the Bolivian Spanish one. Finally, using the free choice paradigm, they show speakers of Bolivian Spanish extensively use the term *verde* (green) to denominate the color chips displayed, in addition to *celeste* (light-blue) and *azul* (blue), as well as *morado* (purple). Less frequent terms are, for example, *fucsia* (fuchsia), *guinda* (maroon) and *mostaza* (mustard).

Several indigenous Amazonian color systems have been studied in the WCS. One of them, Candoshi, has been further examined by @surralles2016. In this thought-provoking study, Surrallés suggests that no proper color term exists in this language. If the fieldworkers of the WCS found otherwise, it is only because they misidentified the elicited terms as color terms while they are nothing more than a series of ad hoc terms referring to objects or animals of the surrounding environment. For example, in Candoshi, the word for yellow is “*ptsiyaromashi*” (“like the feathers of a milvago bird”), the word for red is “*chobiapi*” (“ripe fruit”), the word for green is “*kamachpa*” (“unripe fruit”), etc. These findings lead Surrallés to argue that the Candoshi do not have a proper color system. When they use “color terms” they are not trying to subsume objects of the world under abstract color categories, but they are rather establishing horizontal and ad hoc comparisons between similar objects of the world.
	
A similar criticism of the WCS approach had been previously developed by @everett2005 [p. 627-628] based on his study of Pirahã, another Amazonian language. Everett also rejects the idea that there are basic color terms in this language. He argues that the four color terms identified as basic in the WCS are not such. For example, the word identified as the basic color term for “red” and “yellow” (*bi i sai*) means nothing more than “bloodlike”. Here again, color terms seem to be ad hoc comparisons rather than proper basic terms.

As mentioned earlier, SK color terms have been thoroughly studied in the WCS. It is worth mentioning that two anthropological studies [@morin1973; @tournon2002] have also investigated the color terms used in this Amazonian language. However, these two studies contain some serious methodological pitfalls: a very limited number of chips were tested with only a few participants. As a result, we will not further discuss these studies in the remaining of this article and will only focus on a comparison with the WCS data.

In sum, while some dialectical differences can be noticed across varieties of Spanish, these slight variations are consistent with the general framework proposed by the WCS. Less consistent, however, is the recurrent finding that ad hoc terms seem to play a central role in Amazonian color systems – and possibly also in some South-American varieties of Spanish (such as Colombian Spanish). More broadly, it seems that Amazonian color systems are characterized by fewer color terms than dialectical Spanish systems. 


## The Development of Color Vocabulary


## The Current Study

In the last two decades, cross-cultural research aiming to go beyond North-American “convenience samples” has mainly focused on the study of East Asian children and adults. This endeavor has proved very fruitful [@kitayama2007] but is still limited because of its almost exclusive focus on North-American vs. East-Asian samples. The current study contributes to the general effort to go beyond such samples and study the development of human cognition in a non-North American and non-East Asian context. 
The SK people are an indigenous group located within the Peruvian Amazon. They are mainly horticulturalists, fishermen, occasionally hunters but are noted for their strong display of tradition despite increasingly regular interactions with the western world. Their children receive formal schooling for 4 hours a day and begin formal Spanish lessons closer to adolescence. Most SK adults have some grasp of Spanish but younger adults show more proficiency than elders.
 
The SK indigenous people are particularly interesting for at least two reasons:
They differ from samples usually studied by cross-cultural evolutionary psychologists [@apicella2016]. Indeed, evolutionary psychologists are particularly interested in the study of contemporary hunter-gatherers because they are believed to be a good model of our Pleistocene ancestors. By contrast, like most riverine Amazonian cultures, the SK culture is not based on hunting and gathering, but on horticulture, fishing, and to a limited extent, hunting.

Because of their location on the Ucayali River, one of the main tributaries of the Amazon, the SK culture has always been enmeshed in rich trading networks involving other indigenous groups of the Andes and the Lowlands (in pre-conquest times) as well as Mestizos and Westerners (in post-conquest times) [@lathrap1970]. It would thus be mistaken to think of this culture as an “isolated” or “preserved” one. On the contrary, having been extensively exposed to numerous cultural influences, the SK culture has been constantly reworked and reshaped through the centuries. This was especially true in the second half of the 20th century with intense contact with the Spanish-speaking Mestizo populations established along the Ucayali River. As a result, today’s SK culture straddles two worlds. 


# Study 1

Before we could assess the developmental trajectory of color term knowledge in SK children, our goal was to replicate and update the characterization of the adult SK color system given by the World Color Survey. As the WCS study took place generations prior, we could not assume the SK color term mappings had remained static especially through years of industrialization and exposure to the Spanish language and its own color term system. As such, Study 1 used a modified version of the original WCS protocol, with an identical color chip set. The goals were to characterize the current SK vocabulary and to generate a standard of adult knowledge against which subsequent child participants could be scored.


```{r study1-participants}
study1_participants <- read_csv(here("data/Current_Data/naming_colors_participants.csv")) %>%
  mutate(age = as.numeric(as.character(edad)),
         `edad aprendizaje del espanol` = as.numeric(as.character(`edad aprendizaje del espanol`)))

study1_occupations <- study1_participants %>%
  group_by(género, ocupación) %>%
  summarise (n = n(), .groups = "drop") %>%
  group_by(género) %>%
  mutate(freq_gender = 100*n / sum(n)) %>%
  ungroup() %>%
  mutate(freq_total = 100*n / sum(n))

study1_agespanish_test <- cor.test(~ `edad aprendizaje del espanol` + age, data = study1_participants)

```

## Methods 


**Participants**. Our protocol for Study 1 and all subsequent studies received ethical approval from Pontificia Universidad Católica del Perú’s Institutional Review Board. We recruited `r pull(summarise(study1_participants, n(), .groups = 'drop'))` adult participants (`r pull(summarise(study1_participants, sum(género == 'masculino'), .groups = 'drop'))` men). We experienced difficulty recruiting male participants as many of the men were away from the village during the day, resulting in a sample that is predominantly female. Most participants (31, 4 men) were from SK communities of the Middle Ucayali region (Yarinacocha, San Francisco, and Nueva Betania), with a subset from communities of the Lower (Paoyhan) and Upper (Puerto Belén) Ucayali region. Within the small town of Yarinacocha (in the vicinity of Pucallpa), we recruited participants (9, 2 men) from Bena Jema, a predominantly SK neighborhood. All the other recruitment sites were native community villages with exclusively SK residents. Overall, the sample included SK adults who could be characterized as more urban (Yarinacocha and San Francisco sites) or more traditional and in regular contact with the surrounding rainforest (Nueva Betania, Paoyhan, and Puerto Belén sites).

The median age for participants was `r median(study1_participants$age, na.rm = T)` years (*IQR* = `r paste0(round(quantile(study1_participants$age, probs = c(0.25, 0.75), na.rm = T)), collapse = "-")`) ranging from `r min(study1_participants$age, na.rm = T)` to `r max(study1_participants$age, na.rm = T)` years. Regarding occupations, `r round(filter(study1_occupations, género == 'femenino' & ocupación == 'ama de casa')$freq_gender)`% of the `r pull(summarise(study1_participants, sum(género == 'femenino'), .groups = 'drop'))` female participants were homemakers or housewives (`r round(filter(study1_occupations, género == 'femenino' & ocupación == 'ama de casa')$freq_total)`% of the overall sample) and another `r round(filter(study1_occupations, género == 'femenino' & ocupación == 'artesana')$freq_gender)`% were artisans (`r round(filter(study1_occupations, género == 'femenino' & ocupación == 'artesana')$freq_total)`%). `r Words(filter(study1_occupations, género == 'masculino' & ocupación == 'agricultor')$n)` of the `r pull(summarise(study1_participants, sum(género == 'masculino'), .groups = 'drop'))` male participants (`r round(filter(study1_occupations, género == 'masculino' & ocupación == 'agricultor')$freq_gender)`%, `r round(filter(study1_occupations, género == 'masculino' & ocupación == 'agricultor')$freq_total)`% overall) were horticulturalists. Across both sexes, `r sum(filter(study1_occupations, género == 'femenino' & grepl('estud', ocupación))$n)` women (`r round(sum(filter(study1_occupations, género == 'femenino' & grepl('estud', ocupación))$freq_gender))`%, `r round(sum(filter(study1_occupations, género == 'femenino' & grepl('estud', ocupación))$freq_total))`% overall) and `r filter(study1_occupations, género == 'masculino' & grepl('estud', ocupación))$n` men (`r round(filter(study1_occupations, género == 'masculino' & grepl('estud', ocupación))$freq_gender)`%, `r round(filter(study1_occupations, género == 'masculino' & grepl('estud', ocupación))$freq_total)`% overall) identified as students, comprising a total of `r round(sum(filter(study1_occupations, grepl('estud', ocupación))$freq_total))`% of the population. Although all adult participants were required to be native SK speakers, all were introduced to the Spanish language prior to adolescence (median age = `r median(study1_participants$'edad aprendizaje del espanol', na.rm = T)`yo, *IQR* = `r paste0(quantile(study1_participants$'edad aprendizaje del espanol', c(0.25, 0.75), na.rm = T), collapse = "-")`).

**Materials and procedure**. Similar to the original WCS, we used a set of 330 Munsell color chips and asked participants to name these [@berlin1969]. We made a number of changes to the procedure, however. In the WCS, every participant provided terms for all 330 chips. Due to fear of participant fatigue, we split up color chips based on their ID numbers (even or odd) and participants were randomly assigned work with either even- or odd-numbered color chips. As a result, each participant was presented with only 165 chips. All 330 hues within the set are visualized in Appendix 1. Dimensions of the chips were 2 cm × 2.5 cm. 

First, the experimenter explained the general procedure and goals of the study to a participant. The experimenter would then present a single color chip to the participant and ask in SK: “What is the color of this chip?” The study was conducted solely in SK language with the assistance of a bilingual SK- and Spanish-speaking research assistant. It should be noted that although the experiment was conducted in SK, the SK word for color used is identical to the Spanish word *color* (an example of SK speakers adopting Spanish words into their lexicon), which might have encouraged Spanish language use.

Besides the reduction in set size, our procedure also differed from that of WCS [see @berlin2009, pp. 585--591] in other aspects. Participants sat in front of the experimenter. To manage changes in natural light intensity between participants, the experiment took place indoors near a window or a door instead of outdoors. Another difference between our study and the WCS procedure is in our approach for encouraging participants to describe chips using BCTs. In the WCS, the experimenter would instruct participants to only provide BCTs during the task (e.g., describing a chip as “blue” as opposed to “navy blue” or “sky-like”). However, we had difficulties concisely explaining the concept of a BCT compared to other terms[^1]. We decided to allow participants to describe a chip with any term they wished, and to ask further questions to elicit a BCT when they did not do so on their first try. For example, when presented with a red color chip, the participant might use the term “blood-like” (a non-BCT). The experimenter would ask: “Do you know of any other word to refer to the color of this chip?”. Should the participant subsequently respond with “dark red” (another non-BCT), the experimenter would further ask: “How would you refer to this color with only one word?” Eventually, the participant might use the term “red” (a BCT). For some chips, participants provided a BCT as their first description. For others, a BCT might be preceded by 1 or 2 non-BCTs. When participants failed to provide a BCT after 3 attempts (i.e., two follow-up questions), no further questions were asked, and the experimenter moved on to the next chip. All responses, BCT or not, were recorded in the order produced by the participant. 

[^1]:  Indeed, as @berlin2009 [pp. 587--589] acknowledge, there is no straightforward necessary and sufficient criteria for the basicness of a color term [cf @levinson2000].


## Results and Discussion

```{r study1-profusion}

study1_profusion <- naming_data %>%
  group_by(subj, color_cat, nature) %>%
  summarise(n = n(), .groups = 'drop') %>%
  group_by(color_cat, nature) %>%
  spread(subj, n, fill = 0) %>%
  gather(key = 'subj', value = 'n', -color_cat, -nature) %>%
  mutate(prop = 100*n/165) %>%
  summarise(`% of Subjects Who Used the Term (Current)` = round(100*sum(prop > 0)/n()), 
            `Mdn % of Chips in Set Labeled (Current)` = round(median(prop)),
            `IQR % of Chips in Set Labeled (Current)` = paste0(
              round(quantile(prop, c(0.25,0.75))), collapse = "-"),
            .groups = 'drop')

```

```{r, study1-gender, include = FALSE}

study1_genderbyterm <- naming_data %>%
  group_by(subj, género, color_cat) %>%
  summarise(prop = n()/165, .groups = 'drop') %>%
  complete(nesting(subj, género), color_cat, fill = list(prop = 0))

study1_ttest_gendertermprofusion <- with(
  study1_genderbyterm %>% 
   group_by(color_cat, género) %>%
   summarise(prop = mean(prop), .groups = 'drop') %>%
   spread(género, prop), t.test(femenino, masculino, paired = TRUE))

study1_ttest_gendertermappearance <- with(
  study1_genderbyterm %>% 
    mutate(used = ifelse(prop > 0, 1, 0)) %>%
    group_by(color_cat, género) %>%
    summarise(prop = mean(used), .groups = 'drop') %>%
    spread(género, prop), t.test(femenino, masculino))

```

All participants used the following set of color terms to describe at least once during their session: “joxo” (light/white), “wiso” (dark/black), “panshin” (yellow), “joshin” (red), and “yankon” (green/blue). Given the widespread use of this term set and their interpretations, we will refer to these as SK-language BCTs. Most (`r filter(study1_profusion, color_cat == "Manxan") %>% pull('% of Subjects Who Used the Term (Current)')`%) participants also described at least 1 chip as “manxan” (faded), referring to a chip’s saturation. In terms of overall popularity, participants described a median of `r filter(study1_profusion, color_cat == "Yankon") %>% pull('Mdn % of Chips in Set Labeled (Current)')`% of chips as “yankon” (*IQR* = `r filter(study1_profusion, color_cat == "Yankon") %>% pull('IQR % of Chips in Set Labeled (Current)')`%) followed by “joshin” (*Mdn* = `r filter(study1_profusion, color_cat == "Joshin") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, *IQR* = `r filter(study1_profusion, color_cat == "Joshin") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), “joxo” (`r filter(study1_profusion, color_cat == "Joxo") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Joxo") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), “panshin” (`r filter(study1_profusion, color_cat == "Panshin") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Panshin") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), “manxan” (`r filter(study1_profusion, color_cat == "Manxan") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Manxan") %>% pull('IQR % of Chips in Set Labeled (Current)')`%), and “wiso” (`r filter(study1_profusion, color_cat == "Wiso") %>% pull('Mdn % of Chips in Set Labeled (Current)')`%, `r filter(study1_profusion, color_cat == "Wiso") %>% pull('IQR % of Chips in Set Labeled (Current)')`%). We failed to find any significant sex differences in the overall spread of color term usage across chip set (`r apa_print(study1_ttest_gendertermprofusion)$statistic`) or in the proportion of subjects who used a term at least once during their session (`r apa_print(study1_ttest_gendertermappearance)$statistic`).


```{r study1-langswitch}

study1_switchperc <- naming_data %>%
  mutate(spanish_response = ifelse(color_cat %in% spanish_terms,
                                   1, 0)) %>%
  mutate(overall_spanish = round(100*mean(spanish_response), 0)) %>%
  group_by(subj) %>%
  summarise(overall_spanish = first(overall_spanish),
            atleast_1 = ifelse(sum(spanish_response) > 0, 1, 0),
            by_subject = mean(spanish_response),
            .groups = 'drop') %>% 
  summarise(overall_spanish = first(overall_spanish),
            atleast_1 = round(100*mean(atleast_1)),
            mdn_subj_spanish = round(100*median(by_subject)),
            iqr_subj_spanish = paste0(
              round(100*quantile(by_subject, c(0.25, 0.75))), collapse = "-"),
            max_subj_spanish = round(100*max(by_subject)),
            min_subj_spanish = round(100*min(by_subject)),
            .groups = 'drop')


study1_spanishbychip <- naming_data %>%
  mutate(spanish_response = ifelse(color_cat %in% spanish_terms,
                                   1, 0)) %>%
  select(subj, chip_id, spanish_response) %>%
  mutate(set = ifelse((chip_id %% 2) == 0, 'even', 'odd')) %>%
  split(.$set) %>%
  map_df(function(x) {
    x %>%
      group_by(chip_id) %>%
      summarise(perc = mean(spanish_response), .groups = 'drop')
  }) %>%
  left_join(color_chip_data %>% select("#cnum", "hex"),
            by = c("chip_id" = "#cnum")) %>%
  arrange(desc(perc)) %>%
  rename(`Chip ID` = chip_id, `% of Subjects` = perc, `Hex Code` = hex)

# study1_highestspanish <- datatable(study1_spanishbychip, rownames = FALSE) %>%
#   formatPercentage("% of Subjects", 0) %>%
#   formatStyle(columns = "Hex Code",
#               background = styleEqual(
#                 study1_spanishbychip$`Hex Code`, study1_spanishbychip$`Hex Code`))

```


Compared to the WCS dataset which only reported SK language terms, `r study1_switchperc$atleast_1`% of our participants used a Spanish-language color term to describe at least 1 chip, which accounted for `r study1_switchperc$overall_spanish`% of all responses (Figure \@ref(fig:study1-corrected_entropy)). Across chips, Spanish use peaked at `r round(100*max(study1_spanishbychip$'% of Subjects'))`% when participants were asked to label chips that English speakers would consider to be orange. However, Spanish use varied greatly between subjects (*Mdn* = `r study1_switchperc$mdn_subj_spanish`%, *IQR* = `r study1_switchperc$iqr_subj_spanish`%) with one participant responding in Spanish in `r study1_switchperc$max_subj_spanish`% of the time despite being prompted solely in SK.

```{r study1-consensus}

study1_consensus <- naming_data %>%
  select(subj, chip_id, color_cat) %>%
  mutate(set = ifelse((chip_id %% 2) == 0, 'even', 'odd')) %>%
  split(.$set) %>%
  map_df(function(x) {
    x %>%
      group_by(chip_id, color_cat) %>%
      summarise(n = n(), .groups = 'drop') %>%
      group_by(chip_id) %>%
      mutate(perc = 100*n/sum(n)) %>%
      select(-n)
  }) %>%
  arrange(chip_id) %>%
  rename(`Chip ID` = chip_id, `Color Term` = color_cat, `% of Subjects` = perc) 


```

```{r study1-figure, fig.cap = "(A and B) Plots of the modal term given for a particular chip. Color coordinates were represented in 2-D Munsell space. Modal responses were given by SK adults during (A) the original World Color Survey and during (B) our Study 1. (C) Heat map of prevalence of Spanish-language responses during Study 1. Legends for all three subplots located in the bottom-right quadrant."}

study1_consensus_plot <- ggplot(study1_consensus %>%
                                 group_by(`Chip ID`) %>%
                                 filter(`% of Subjects` == max(`% of Subjects`)) %>%
                                 left_join(color_chip_data, by = c("Chip ID" = "#cnum")), 
                               aes(x = H, y = V, fill = `Color Term`)) + 
  geom_tile() + 
  scale_size(range = c(0, 2.0)) + 
  scale_fill_manual(name = "Color Term",values = graph_colors) +
  ggtitle("Study 1") +
  guides(fill=guide_legend(ncol=2,byrow=TRUE)) +
  theme(plot.title = element_text(hjust = 0.5))

kay_consensus <- kay_terms %>%
  mutate(Term = ifelse(Term %in% c('Huiso', 'Wiso'), 'Wiso', as.character(Term))) %>%
  group_by(`WCS Chip Number`, Term) %>%
  summarise(n = n(), .groups = 'drop') %>%
  group_by(`WCS Chip Number`) %>%
  mutate(`% of Subjects` = 100*n/sum(n)) %>%
  select(-n) %>%
  group_by(`WCS Chip Number`) %>%
  filter(`% of Subjects` == max(`% of Subjects`)) %>%
  dplyr::rename(`Color Term` = Term, `Chip ID` = `WCS Chip Number`) %>%
  left_join(color_chip_data, by = c("Chip ID" = "#cnum"))


kay_consensus_plot <- ggplot(kay_consensus, 
                             aes(x = H, y = V, fill = `Color Term`)) + 
  geom_tile() + 
  scale_size(range = c(0, 2.0)) + 
  scale_fill_manual(name = "Color Term",values = graph_colors) +
  ggtitle("WCS Data") +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5))

study1_spanish_plot <- ggplot(study1_spanishbychip %>%
                               mutate(`% of Subjects` = 100*`% of Subjects`) %>%
                               rename(`Spanish Term` = `% of Subjects`) %>%
                               left_join(select(color_chip_data, `#cnum`, V, H), 
                                         by = c("Chip ID" = "#cnum")), 
                             aes(x = H, y = V)) + 
  geom_tile(aes(fill = `Spanish Term`)) + 
  scale_fill_viridis(option="magma") +
  labs(fill = "Spanish\nUse (%)")

adult_figurelegends <- plot_grid(
  get_legend(study1_consensus_plot),
  NULL,
  get_legend(study1_spanish_plot),
  # labels = c("A and B", "", "C"),
  ncol = 3) + 
  theme(plot.margin = unit(c(0.5,0.5,0.5,1), "in")) 

adult_figure <- plot_grid(
  study1_consensus_plot + theme(legend.position = "none"), 
  kay_consensus_plot + theme(legend.position = "none"), 
  study1_spanish_plot + theme(legend.position = "none"), 
  adult_figurelegends, 
  labels = c("A", "B", "C"), ncol = 2
  )

print(adult_figure)

# study1_spanishbysubj <- naming_data %>%
#   mutate(spanish_response = ifelse(color_cat %in% spanish_terms, 1, 0)) %>%
#   group_by(subj) %>%
#   summarise(age = as.numeric(as.character(first(edad))),
#             age_introduction = first(`edad aprendizaje del espanol`),
#             mean_spanish = mean(spanish_response, na.rm = TRUE),
#             .groups = 'drop')
# 
# study1_spanishbyintro_test <- cor.test(~ age_introduction + mean_spanish, data = study1_spanishbysubj)
# study1_spanishbyage_test <- cor.test(~ age + mean_spanish, data = study1_spanishbysubj)

```




```{r study1-termnature}
study1_nature <- naming_data %>%
  mutate(spanish_response = ifelse(color_cat %in% spanish_terms, 1, 0),
         nature = ifelse(grepl("SLT", nature), "SLT", nature)) %>%
  group_by(subj, spanish_response, nature) %>%
  summarise(n = n(), .groups = "drop") %>%
  mutate(nature = ifelse(is.na(nature), "Other", nature)) %>%
  complete(subj, spanish_response, nature, fill = list(n = 0)) %>%
  group_by(subj) %>%
  mutate(perc = 100*n/sum(n)) %>%
  group_by(spanish_response, nature) %>%
  summarise(mdn_prop = round(median(perc)),
            iqr_prop = paste0(round(quantile(perc, c(0.25, 0.75))), collapse = "-"),
            .groups = "drop")

SK_AHCT_prop <- group_by(naming_data, subj) %>%
  summarise(SK_AHCT = sum(!color_cat %in% spanish_terms & nature == "AHCT", na.rm = T),
            .groups = 'drop') %>%
  summarise(round(100*mean(SK_AHCT > 0)), .groups = 'drop')

```

Participants used an SK-language BCT (i.e., “yankon”) to describe a median of `r filter(study1_nature, nature == "BCT" & spanish_response == 0) %>% pull(mdn_prop)`% of chips (*IQR* = `r filter(study1_nature, nature == "BCT" & spanish_response == 0) %>% pull(iqr_prop)`%). Besides BCTs, `r SK_AHCT_prop`% of participants used SK-language ad hoc hue terms (i.e., “nai” or sky for blue chips) for an overall median of `r filter(study1_nature, nature == "AHCT" & spanish_response == 0)$mdn_prop`% of chips  (*IQR* = `r filter(study1_nature, nature == "AHCT" & spanish_response == 0)$iqr_prop`%). SK-language terms referring to saturation or luminosity of a chip, such as “manxan” (faded) were used for an overall median of `r filter(study1_nature, nature == "SLT" & spanish_response == 0)$mdn_prop`% of chips (*IQR* = `r filter(study1_nature, nature == "SLT" & spanish_response == 0)$iqr_prop`%). Most instances (`r filter(naming_data, color_cat %in% spanish_terms) %>% summarise(round(100*sum(nature == "BCT")/n()), .groups = 'drop')`%) of Spanish use involved a Spanish BCT such as “rojo” (overall *Mdn* = `r filter(study1_nature, nature == "BCT" & spanish_response == 1)$mdn_prop`%, *IQR* = `r filter(study1_nature, nature == "BCT" & spanish_response == 1)$iqr_prop`%). In other words, participants  responded in Spanish to label chips with basic color categories but mostly relied on SK for all other descriptor types.



```{r study1-corrected_entropy}
study1_entropy <- naming_data %>%
  group_by(chip_id, color_cat) %>% 
  select(chip_id, color_cat) %>%
  count %>%
  group_by(chip_id) %>%
  mutate(p = n / sum(n)) %>%
  summarise(entropy = - sum(p * log(p)), .groups = 'drop') %>%
  rename(`Chip ID` = chip_id, 
         Entropy = entropy)

study1_naturebyentropy <- naming_data %>%
  mutate(response_language = case_when(
    color_cat %in% spanish_terms ~ "spanish",
    color_cat %in% shipibo_terms ~ "shipibo"
  )) %>%
  select(subj, chip_id, color_cat, response_language, nature) %>%
  mutate(shipibo_BCT = ifelse(nature == "BCT" & response_language == "shipibo", 1, 0),
         shipibo_AHCT = ifelse(nature == "AHCT" & response_language == "shipibo", 1, 0),
         spanish_BCT = ifelse(nature == "BCT" & response_language == "spanish", 1, 0),
         spanish_AHCT = ifelse(nature == "AHCT" & response_language == "spanish", 1, 0)) %>%
  mutate(across(shipibo_BCT:spanish_AHCT, ~ifelse(is.na(.), 0, .))) %>%
  group_by(chip_id) %>%
  summarise(across(shipibo_BCT:spanish_AHCT, ~ mean(., na.rm = TRUE)), .groups = 'drop') %>%
  right_join(study1_entropy, by = c("chip_id" = "Chip ID")) %>%
  select(`Chip ID` = chip_id, Entropy, ends_with("CT", ignore.case = FALSE))

## A little circular for a correlation?
study1_naturebyentropy_test <- cor.test(~ shipibo_BCT + Entropy, data = study1_naturebyentropy)

study1_naturebyentropy_plot <- ggplot(study1_naturebyentropy %>% 
         gather(key = "measure", value = "prop", ends_with("CT")) %>%
         separate(measure, c("language", "nature"), sep = "_") %>%
         mutate(language = tools::toTitleCase(language),
                nature = case_when(
                  nature == "BCT" ~ "Basic color term",
                  nature == "AHCT" ~ "Ad-hoc color term"),
                language = relevel(factor(language), ref = "Shipibo"),
                nature = relevel(factor(nature), ref = "Basic color term")),
       aes(x = Entropy, y = prop, group = interaction(language, nature), colour = language, shape = nature)) +
  geom_smooth(method = "loess", aes(fill = language, linetype = nature), alpha = .2) +
  labs(x = "Labelling Entropy of Chip", 
       y = "Proportion of Responses", 
       fill = "Language", 
       color = "Language", 
       linetype = "Nature of Response") +
  ggthemes::scale_fill_ptol() +
  ggthemes::scale_color_ptol() +
  coord_cartesian(ylim = c(0,1)) +
  theme_apa()

print(study1_naturebyentropy_plot)

```


# Study 2

After generating an updated SK color term map using the responses from adult participants in Study 1, we created Study 2 to assess child participants’ production and comprehension of SK color terms. Because we did not think that we could feasibly ask children across a range of ages about more than 100 color chips, we selected a subset of chips representing the prototypical instances for prominent SK terms from Study 1.

```{r study2-participants}

study2_prod_data <- raw_data %>%
  filter(language == "Shipibo" & task == "Production") %>%
  mutate(spanish_response = ifelse(response %in% spanish_terms, 1, 0)) 

study2_participants <- study2_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% ungroup() %>%
  summarise(min_age = min(age_interval),
            max_age = max(age_interval),
            num_56 = sum(age_interval %in% 5:6),
            num_78 = sum(age_interval %in% 7:8),
            num_910 = sum(age_interval %in% 9:10),
            num_1112 = sum(age_interval %in% 11:12),
            num_benajema = sum(location == 'bena jema'),
            num_bilingue = sum(location == 'bilingue'),
            num_ccnn = sum(location == 'c.c.n.n. (bahuanisho)'),
            num_boys = sum(gender == "masculino"),
            num_total = n(),
            .groups = 'drop')
```

```{r study3-participants}


study3_prod_data <- raw_data %>%
  filter(language == "Spanish" & task == "Production") %>%
  mutate(shipibo_response = ifelse(response %in% shipibo_terms, 1, 0)) 

study3_participants <- study3_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% ungroup() %>%
  summarise(min_age = min(age_interval),
            max_age = max(age_interval),
            num_56 = sum(age_interval %in% 5:6),
            num_78 = sum(age_interval %in% 7:8),
            num_910 = sum(age_interval %in% 9:10),
            num_1112 = sum(age_interval %in% 11:12),
            num_benajema = sum(location == 'bena jema'),
            num_bilingue = sum(location == 'bilingue'),
            num_ccnn = sum(location == 'c.c.n.n. (bahuanisho)'),
            num_boys = sum(gender == "masculino"),
            num_total = n(), 
            .groups = 'drop')
```



```{r study23-demographics, results='asis'}

study2_demographics <- study2_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% group_by(age_interval) %>%
  summarise(num_total = n(),
            num_boys = sum(gender == 'masculino'),
            mean_age = round(mean(age), 1),
            sd_age = round(sd(age), 2),
            .groups = 'drop') %>% ungroup() %>%
  mutate(freq_total = round(100*num_total/sum(num_total)),
         freq_boys = round(100*num_boys/num_total)) %>%
  mutate(`Age Group` = as.character(age_interval),
         `n` = paste0(num_total, " (", freq_total, "%", ifelse(`Age Group` == "5", " of overall sample", ""), ")"),
         `Boys` = num_boys) %>%
  select(`Age Group`, `n`, `Boys`)
  
# apa_table(study2_demographics, caption = "Demographics of participants in Study 2.")

study3_demographics <- study3_prod_data %>%
  group_by(subj) %>%
  filter(row_number() == 1) %>% group_by(age_interval) %>%
  summarise(num_total = n(),
            num_boys = sum(gender == 'masculino'),
            mean_age = round(mean(age), 1),
            sd_age = round(sd(age), 2),
            .groups = 'drop') %>%
  mutate(freq_total = round(100*num_total/sum(num_total)),
         freq_boys = round(100*num_boys/num_total)) %>%
  mutate(`Age Group` = as.character(age_interval),
         `n` = paste0(num_total, " (", freq_total, "%", ifelse(`Age Group` == "5", " of overall sample", ""), ")"),
         `Boys` = num_boys) %>%
  select(`Age Group`, `n`, `Boys`)
  
# apa_table(study3_demographics, caption = "Demographics of participants in Study 3.")

apa_table(
  list(`Study 1` = study2_demographics, `Study 2` = study3_demographics),
  caption = "Demographics of participants in Studies 2 and 3.",
  added_stub_head = "Variables",
  merge_method = "table_spanner")

```

## Methods

**Participants**. `r Words(study2_participants$num_total)` children (`r study2_participants$num_boys` boys) ages `r study2_participants$min_age`- to `r study2_participants$max_age`-years-old were recruited in predominantly SK neighborhoods in Yarinacocha (Nueva Era and Bena Jema) and in Bawanisho, a native community settled along the Ucayali River, more than 500 kilometers southeast of Pucallpa. Recruitment occurred either through direct contact with interested parents or through their local school. If recruited via school, consent for participation had to be given by both teacher and parent. Outside of the school environment, consent was only given by the parent. 


**Materials and procedure**. Based on the findings of Study 1, we chose 8 color chips from our original set of 330 to serve as prototypical instances of major SK color terms. These color chips were blue (WCS n°1), green (n°234), red (n°245), white (n°274), yellow (n°297), black (n°312), greeny-yellow (WCS n°320), and purple (WCS n°325) (see Appendix 1). Study 2 was conducted entirely in SK and participants were explicitly instructed to give responses in SK as opposed to Spanish. In the production and comprehension tasks, children sat at a table across from the experimenter with color chips arranged between them. The production task was always performed before the comprehension task.


**Production task**. Similar to Study 1, the experimenter introduced a participant to the general procedure and the goals of the study. The experimenter would then ask: “What is the color of this chip?” As in Study 1, we used follow-up questions to elicit a BCT when the child’s initial response was not a BCT. In a departure from Study 1, we were more explicit in soliciting an SK-language response. When a participant provided a Spanish-language term, the experimenter would record their response but further ask: “What is the name of this color in SK?” If a participant could not respond with an SK term, the experimenter would not ask further questions and would move forward to the next chip. As a result, some children could only produce SK non-BCTs or Spanish-language terms for particular chips. 

**Comprehension task**. The comprehension task had a notably different procedure compared to the preceding production task or that of Study 1. We tested the comprehension of 9 SK color terms. The choice of these terms was based on common responses given by adult participants in Study 1. The color term prompts included BCTs: *yankon* (“green/blue”), *joshin* (“red”), *panshin* (“yellow”), *joxo* (“white/light”), *wiso* (“black/dark”). We also included non-basic but prominent terms as prompts which were *nai* (“blue/sky”), and *barin poi* (“greenish-yellow”) and two dyads of non-basic terms *pei*/*xo* (“green”) and *ami*/*pua* (“purple”). Children sat at a table across from the experimenter with the 8 color chips of the production task displayed between them. The experimenter asked: “Can you give me the [*color term*] chip?” Participants chose one of the 8 chips and their response was recorded.  

Our findings from Study 1 suggested that color terms varied in their degrees of specificity. For example, *wiso* best describes a narrow range of very dark to black. By contrast, *yankon* could encompass blue, green, greenish-yellow, and purple; *joshin* could describe red, purple, and orange; *pei* or *xo* to green or greenish-yellow. In cases where a term could apply for more than one chip (i.e., *yankon*), the initially selected chip would be removed from the table, leaving 7 remaining chips. The experimenter would then ask: “Can you give me another [*color term*] chip?” The participant would then pick another one of the 7 chips, have their response recorded, and so on. We prompted participants 4 times for *yankon* and 2 times each for *joshin* and *pei*/*xo*; every other term only received a single prompt. Due to the inherent ambiguity in term-hue pairings, accuracy for a child participant was coded based on adult responses given during Study 1. If at least 15% of adult participants in Study 1 associated a chip with a particular term, we coded a similar term-chip pairing from a child participant as correct. Some trials could have multiple pairings, accuracy was scored as an average, rather than dichotomous. For instance, if a child correctly chose 3 out of 4 chips for the "yankon" trial, instead of 1 (correct) or 0 (incorrect) they would receive a score of 0.75.


```{r prod-childfigure, fig.height = 9.5, fig.cap = "(A and B) A comparison of children's performance during the production task in Studies 2 (top) and 3 (bottom). Solid or dotted lines represent overall performance by age for a particular chip. Solid lines show whether the child gave a correct answer in the language indicated in that column; dotted lines show if they gave a response that was correct in either language. Line colors are representative of the chip’s color coordinates."}

study23_firstprod <- raw_data %>% 
  filter(task == 'Production' & response_order %in% c('first','only')) %>%
  rename(study = language) %>% mutate(prompt = as.character(prompt),
    study = case_when(
      study == "Shipibo" ~ "Study 2",
      study == "Spanish" ~ "Study 3"),
    correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent),
    correct_all = correct_either + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent)) %>%
  group_by(study, age, prompt) %>%
  gather(key = "criteria", value = "score", 
         starts_with("correct")) %>%
  left_join(study1_entropy %>% 
              mutate(`Chip ID` = as.character(`Chip ID`)), 
            by = c("prompt" = "Chip ID"))

plot_accuracyvsentropy <- function(df) {
  
  df_correct <- filter(df, criteria == "correct") %>%
    group_by(study, age_interval, prompt, criteria) %>%
    summarise(score = mean(score, na.rm = T), .groups = 'drop')
  
  accuracyvsentropy_plot <- ggplot(df %>% filter(criteria != "correct_all"), 
                                   aes(x = age_interval, y = score, colour = prompt,
                           group = criteria, linetype = criteria)) +
  geom_jitter(data = df_correct,
    alpha = .4, width = .3, height = .1, col = "gray") + 
  geom_smooth(se = FALSE, method = "loess", span = 1) +
  facet_wrap(~ as.character(as.numeric(prompt)), scales = "free", ncol = 3) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
  xlim(c(5,11.5)) +
  scale_color_manual(values = chip_id_colors, guide = FALSE) +
  scale_linetype_manual(values = graph_lines, guide = FALSE) +
  labs(x = "Age", y = "Proportion of Correct Responses", 
       linetype = "Measure", colour = "Chip ID") +
  guides(label = "none") + 
  geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
                 label = sprintf("%.2f", round(Entropy,2))),
             show.legend = FALSE, colour = "black") + 
    theme(legend.position = "none")
  
  return(accuracyvsentropy_plot)
}

study2_firstprod <- study23_firstprod %>% filter(study == "Study 2")
study3_firstprod <- study23_firstprod %>% filter(study == "Study 3")

prod_accuracyvsage_2 <- plot_accuracyvsentropy(study2_firstprod)

prod_accuracyvsage_3 <- plot_accuracyvsentropy(study3_firstprod)

prod_childfigure <- plot_grid(prod_accuracyvsage_2 + theme(axis.title.x = element_blank()), 
          prod_accuracyvsage_3, labels = c("A", "B"), rel_heights = c(3,4), ncol = 1)

# print(prod_childfigure)

```


```{r study2-prodtable, results='asis'}

# study2_firstprod_table <- study2_firstprod %>% 
#   filter(criteria == "correct") %>%
#   group_by(age_interval, prompt, spanish) %>%
#   summarise(n = n(), 
#             prop = round(mean(score), 2),
#             .groups = "drop") %>%
#   bind_rows(
#     study2_firstprod %>% 
#     filter(criteria == "correct") %>%
#     group_by(age_interval) %>%
#     summarise(n = n_distinct(subj),
#               prop = round(mean(score), 2),
#               prompt = "Overall",
#               spanish = "",
#               .groups = "drop")
#   )  %>%
#   mutate(
#     age_interval = case_when(
#       age_interval == 5 ~ sprintf("%d-years-old (%d children)", age_interval, n),
#       age_interval > 5 ~ sprintf("%d-years-old (%d)", age_interval, n)
#     ),
#     prompt = case_when(
#       spanish != "" ~ sprintf("n°%s (%s)", prompt, spanish),
#       spanish == "" ~ prompt
#   )) %>%
#   select(-n, -spanish) %>%
#   pivot_wider(names_from = age_interval, values_from = prop)

# apa_table(study2_firstprod_table, caption = "Demographics of participants in Study 2.")

```


```{r study2-prod-model-overall}

study2_firstprod$age.years.c <- scale(study2_firstprod$age, scale = FALSE)

study2_firstprod_same <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct"), 
      family = "binomial")

study2_firstprod_same_noage <- glmer(score ~ (1 | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct"), 
      family = "binomial")

study2_firstprod_either <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct_either"), 
      family = "binomial")

study2_firstprod_adjacent <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study2_firstprod, criteria == "correct_nearby"), 
      family = "binomial")

study2_firstprod_all <- glmer(score ~ age.years.c*criteria + (age.years.c | prompt) + (1 | subj), 
      data = mutate(study2_firstprod, criteria = factor(criteria)), 
      family = "binomial")


```

```{r study3-prod-model-overall}

study3_firstprod$age.years.c <- scale(study3_firstprod$age, scale = FALSE)

study3_firstprod_same <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct"), 
      family = "binomial")

study3_firstprod_same_noage <- glmer(score ~ (1 | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct"), 
      family = "binomial")

study3_firstprod_either <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct_either"), 
      family = "binomial")

study3_firstprod_adjacent <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study3_firstprod, criteria == "correct_nearby"), 
      family = "binomial")

study3_firstprod_all <- glmer(score ~ age.years.c + criteria + (age.years.c | prompt) + (1 | subj), 
      data = mutate(study3_firstprod, criteria = factor(criteria)), 
      family = "binomial")

```


```{r study2-prod-model-original}

# study2_prod_predict <- with(study2_firstprod, expand.grid(subj = NA, prompt = unique(prompt), age.years.c = seq(min(age.years.c), max(age.years.c),0.05)))
# 
# study2_prod_predict$fit <- predict(study2_firstprod_same, newdata = study2_prod_predict, re.form = NA, type = "response")
# 
# study2_prod_predict$age <- study2_prod_predict$age.years.c + attr(study2_firstprod$age.years.c , 'scaled:center')
# 
# study2_prod_predict <- study2_prod_predict %>%
#   left_join(mutate(shipibo_chip_set, chip_id = factor(as.character(chip_id))), by = c("prompt" = "chip_id")) %>%
#   select(-subj, prompt, shipibo:munsell_code, age.years.c, age, fit)
# 
#   study2_model_compare <- study23_firstprod %>% 
#     filter(study == "Study 2" & criteria == "correct" & !is.na(score)) %>%
#     group_by(prompt, Entropy, age_interval) %>%
#     summarise(score = mean(score), n = n_distinct(subj),
#               .groups = 'drop') %>%
#     ggplot(., aes(x = age_interval, y = score, colour = prompt)) +
#     geom_point(aes(size = n)) +
#     geom_line(data = study2_prod_predict, mapping = aes(x = age, y = fit)) +
#     facet_wrap(~ as.character(prompt), scales = "free", ncol = 3) +
#     scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
#     xlim(c(5,11.5)) +
#     scale_color_manual(values = chip_id_colors, guide = FALSE) +
#     labs(x = "Age", y = "Proportion of Correct Responses", colour = "Chip ID") +
#     guides(label = "none") + 
#     geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
#                    label = sprintf("%.2f", round(Entropy,2))),
#                show.legend = FALSE, colour = "black") + 
#     theme_apa()
  
```


```{r study2-prod-model-byprompt}

# study2_firstprod$age.years.c <- scale(study2_firstprod$age, scale = FALSE)
# 
# fit_glm <- function(df) {
#   mdl <- glmer(score ~ age.years.c + (1 | subj), data = df, family = "binomial")
#   
#   new.df <- with(study2_firstprod, data.frame(subj = NA, age.years.c = seq(min(age.years.c), max(age.years.c),0.05)))
#   
#   new.df$fit <- predict(mdl, newdata = new.df, re.form = NA, type = "response")
#   new.df$prompt <- first(df$prompt)
#   
#   return(new.df)
# }
# 
# y <- study2_firstprod %>%
#   filter(criteria == "correct") %>%
#   split(.$prompt) %>%
#   map_df(fit_glm) %>%
#   mutate(age = age.years.c + attr(study2_firstprod$age.years.c , 'scaled:center')) %>%
#   left_join(mutate(shipibo_chip_set, chip_id = factor(as.character(chip_id))), by = c("prompt" = "chip_id")) %>%
#   select(-subj, prompt, shipibo:munsell_code, age.years.c, age, fit)
# 
# 
# y2_model_compare <- study23_firstprod %>% 
#   filter(study == "Study 2" & criteria == "correct" & !is.na(score)) %>%
#   group_by(prompt, Entropy, age_interval) %>%
#   summarise(score = mean(score), n = n_distinct(subj),
#             .groups = 'drop') %>%
#   ggplot(., aes(x = age_interval, y = score, colour = prompt)) +
#   geom_point(aes(size = n)) +
#   geom_line(data = y, mapping = aes(x = age, y = fit)) +
#   facet_wrap(~ as.character(prompt), scales = "free", ncol = 3) +
#   scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
#   xlim(c(5,11.5)) +
#   scale_color_manual(values = chip_id_colors, guide = FALSE) +
#   labs(x = "Age", y = "Proportion of Correct Responses", colour = "Chip ID") +
#   guides(label = "none") + 
#   geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
#                  label = sprintf("%.2f", round(Entropy,2))),
#              show.legend = FALSE, colour = "black") + 
#   theme_apa()

```


```{r study2-prod-model-aoa}


fit_robust <- function(df) {
  
  mdl <- robustbase::glmrob(score ~ age, data = df, family = "binomial")
  
  new.df <- with(study2_firstprod, data.frame(age = seq(min(age), max(age),0.05)))
  new.df <- cbind(new.df, predict(mdl, newdata = new.df, re.form = NA, type = "response", se.fit = TRUE))
  new.df$prompt <- first(df$prompt)
  
  return(new.df)
}

study2_prod_predict <- study2_firstprod %>%
  filter(criteria == "correct") %>%
  split(.$prompt) %>%
  map_df(fit_robust) %>%
  left_join(mutate(shipibo_chip_set, chip_id = factor(as.character(chip_id))), by = c("prompt" = "chip_id")) %>%
  select(prompt, shipibo:munsell_code, age, fit, se.fit)

study2_prod_predict_aoa <- study2_prod_predict %>% 
  group_by(prompt) %>% 
  filter(fit > 0.5, .preserve = TRUE) %>% 
  summarise(aoa = as.character(round(min(age), 1)), .groups = 'drop') %>%
  mutate(aoa = ifelse(aoa == "Inf", "N/A", aoa))


z2_model_compare <- study23_firstprod %>% 
  filter(study == "Study 2" & criteria == "correct" & !is.na(score)) %>%
  group_by(prompt, Entropy, age_interval) %>%
  summarise(score = mean(score), n = n_distinct(subj),
            .groups = 'drop') %>%
  left_join(study2_prod_predict_aoa, by=("prompt")) %>%
  ggplot(., aes(x = age_interval, y = score, colour = prompt)) +
  geom_point(aes(size = n)) +
  geom_line(data = study2_prod_predict, mapping = aes(x = age, y = fit)) +
  facet_wrap(~ as.character(prompt), scales = "free", ncol = 3) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
  xlim(c(5,11.5)) +
  scale_color_manual(values = chip_id_colors, guide = FALSE) +
  labs(x = "Age", y = "Proportion of Correct Responses", colour = "Chip ID") +
  guides(label = "none") + 
  geom_label(aes(x = Inf, y = -Inf, hjust = 1.1, vjust = -0.3, 
                 label = sprintf("Entropy: %.2f\nAoA: %s", round(Entropy,2), aoa)),
             show.legend = FALSE, colour = "black") + 
  theme_apa()


```

```{r study2-accuracyswitchentropy, results='asis'}

study2_overallscore <- study2_prod_data %>%
  group_by(subj, age) %>%
  summarise(correct = mean(correct, na.rm = T), .groups = 'drop')

study2_overallscore_test <- cor.test(~ correct + age, data = study2_overallscore)

study2_overallswitch <- study2_prod_data %>%
  group_by(subj, age, prompt) %>%
  summarise(spanish_response = ifelse(sum(spanish_response) >= 1, 1, 0), .groups = 'drop_last') %>%
  summarise(n_spanish = sum(spanish_response),
            n_trials = n(),
            perc_spanish = n_spanish/n_trials, 
            .groups = 'drop')

study2_overallswitch_test <- cor.test(~ n_spanish + age, data = study2_overallswitch)


study2_switchperc <- study2_prod_data %>% ungroup() %>%
  mutate(response_order = case_when(
    response_order %in% c("only", "first") ~ "first",
    response_order %in% c("middle", "last") ~ "subsequent"),
    overall_response = round(100*mean(spanish_response))) %>% 
  group_by(overall_response, response_order) %>%
  summarise(spanish_response = round(100*mean(spanish_response)),
            .groups = 'drop')

study2_switchbyentropy <- study2_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID"))

study2_switchbyentropy$age.years.c <- scale(study2_switchbyentropy$age, scale = FALSE)[,1]

study2_SwitchEnt_model <- lme4::glmer(
  spanish_response ~ age.years.c * Entropy + (1|subj),
  data=study2_switchbyentropy, family = "binomial")

apa_table(apa_print(study2_SwitchEnt_model)$table)

```

```{r study3-accuracyswitchentropy, results='asis'}

study3_overallscore <- study3_prod_data %>%
  group_by(subj, age) %>%
  summarise(correct = mean(correct, na.rm = T), .groups = 'drop')

study3_overallscore_test <- cor.test(~ correct + age, data = study3_overallscore)

study3_overallswitch <- study3_prod_data %>%
  group_by(subj, age, prompt) %>%
  summarise(shipibo_response = ifelse(sum(shipibo_response) >= 1, 1, 0), .groups = 'drop_last') %>%
  summarise(n_shipibo = sum(shipibo_response),
            n_trials = n(),
            perc_shipibo = n_shipibo/n_trials, 
            .groups = 'drop')

study3_overallswitch_test <- cor.test(~ n_shipibo + age, data = study3_overallswitch)

study3_switchperc <- study3_prod_data %>% ungroup() %>%
  mutate(response_order = case_when(
    response_order %in% c("only", "first") ~ "first",
    response_order %in% c("middle", "last") ~ "subsequent"),
    overall_response = round(100*mean(shipibo_response))) %>% 
  group_by(overall_response, response_order) %>%
  summarise(shipibo_response = round(100*mean(shipibo_response)),
            .groups = 'drop')

study3_switchbyentropy <- study3_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID"))


study3_switchbyentropy$age.years.c <- scale(study3_switchbyentropy$age, scale = FALSE)[,1]


study3_SwitchEnt_model <- lme4::glmer(
  shipibo_response ~ age.years.c + Entropy + (1|subj),
  data=study3_switchbyentropy, family = "binomial")

apa_table(apa_print(study3_SwitchEnt_model)$table)

```

```{r study2-overextensions}


study2_adjacentorswitch_whole <- study2_prod_data %>%
  group_by(subj, age) %>%
  filter(response_order %in% c("first", "only")) %>%
  mutate(correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent),
         correct_all = ifelse(correct + correct_either + correct_nearby > 0, 1, 0)) %>%
  select(subj, age, prompt, wrong_adjacent, starts_with("correct")) %>%
  gather(key = "measure", value = "score", starts_with("correct")) %>%
  mutate(measure = factor(gsub("_","",measure)))

study2_adjacentorswitch_whole$age.years.c <- scale(study2_adjacentorswitch_whole$age, scale = FALSE)[,1]

study2_adjacentorswitch <- study2_adjacentorswitch_whole %>%
  group_by(subj, age, age.years.c, measure) %>%
  summarise(score = mean(score), .groups = 'drop')

study2_AdjSwitchModel <- lme4::glmer(
  score ~ age.years.c * measure + (1 | subj) ,
  data=study2_adjacentorswitch_whole, family = "binomial")

study2_adjacentbyentropy <- study2_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID")) %>%
  mutate(wrong_adjacent = ifelse(is.na(wrong_adjacent), 0, wrong_adjacent))

study2_adjacentbyentropy$age.years.c <- scale(study2_adjacentbyentropy$age, scale = FALSE)[,1]

study2_AdjacEnt_model <- lme4::glmer(
  wrong_adjacent ~ age.years.c + Entropy + (1|subj),
  data=study2_adjacentbyentropy, family = "binomial")

# apa_table(apa_print(study2_AdjacEnt_model)$table)


```

```{r study3-overextensions}
study3_adjacentorswitch_whole <- study3_prod_data %>%
  group_by(subj, age, gender) %>%
  filter(response_order %in% c("first", "only")) %>%
  mutate(correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent),
         correct_all = ifelse(correct + correct_either + correct_nearby > 0, 1, 0)) %>%
  select(subj, age, gender, starts_with("correct")) %>%
  gather(key = "measure", value = "score", starts_with("correct")) %>%
  mutate(measure = factor(gsub("_","",measure)))

study3_adjacentorswitch_whole$age.years.c <- scale(study3_adjacentorswitch_whole$age, scale = FALSE)[,1]

study3_adjacentorswitch <- study3_adjacentorswitch_whole %>%
  group_by(subj, age, age.years.c, gender, measure) %>%
  summarise(score = mean(score), .groups = 'drop') 

study3_AdjSwitchModel <- summary(lme4::glmer(
  score ~ age.years.c + measure + (1|subj),
  data=study3_adjacentorswitch_whole, family = "binomial"))

study3_adjacentbyentropy <- study3_prod_data %>%
  filter(spanish %in% c("Blanco", "Negro", "Morado", "Amarillo", "Verde", "Rojo") & 
           response_order %in% c("first", "only")) %>%
  left_join(study1_entropy %>% mutate(`Chip ID` = as.character(`Chip ID`)),
            by = c("prompt" = "Chip ID")) %>%
  mutate(wrong_adjacent = ifelse(is.na(wrong_adjacent), 0, wrong_adjacent))

study3_adjacentbyentropy$age.years.c <- scale(study3_adjacentbyentropy$age, scale = FALSE)[,1]

study3_AdjacEnt_model <- lme4::glmer(
  wrong_adjacent ~ age.years.c + Entropy + (1|subj),
  data=study3_adjacentbyentropy, family = "binomial")

```


```{r comp-childfigure, fig.height = 9.5, fig.cap = "(A and B) A comparison of children's performance during the comprehension tasks in Studies 2 (top) and 3 (bottom). Solid or dotted lines represent overall performance by age for a particular chip. Solid lines show whether the child chose the correct chip when prompted with a color term; dotted lines show whether a child chose the correct chip or a chip from an adjacent color category. Line colors are representative of the label’s prototypical color coordinates."}

study23_overallcomp <- raw_data %>% 
  filter(task == 'Comprehension') %>% select(-correct_either) %>%
  rename(study = language) %>% mutate(
    study = case_when(
      study == "Shipibo" ~ "Study 2",
      study == "Spanish" ~ "Study 3"),
    correct_nearby = correct + ifelse(is.na(wrong_adjacent), 0, wrong_adjacent)) %>%
  group_by(study, age, prompt) %>%
  gather(key = "criteria", value = "score", 
         starts_with("correct")) 

plot_compaccuracyvsage <- function(df) {
  
  df_correct <- filter(df, criteria == "correct") %>%
    group_by(study, age_interval, prompt, criteria) %>%
    summarise(score = mean(score, na.rm = T), .groups = 'drop')
  
  compaccuracyvsage_plot <- ggplot(df, aes(x = age_interval, y = score, colour = prompt,
                           group = criteria, linetype = criteria)) +
  geom_jitter(data = df_correct,
    alpha = .25, width = .3, height = .1, col = "gray") + 
  geom_smooth(se = FALSE, method = "loess", span = 1) +
  facet_wrap(~ prompt, scales = "free", ncol = 3) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) + 
  xlim(c(5,11.5)) +
  scale_color_manual(values = graph_colors, guide = FALSE) +
  scale_linetype_manual(values = graph_lines, guide = FALSE) +
  labs(x = "Age", y = "Proportion of Correct Responses", 
       linetype = "Measure", colour = "Color Term") +
  guides(label = "none") +
  theme(legend.position = "none", strip.text = element_text(face = "bold", size = 9))
  
  return(compaccuracyvsage_plot)
}

comp_accuracyvsage_2 <- plot_compaccuracyvsage(filter(study23_overallcomp, study == "Study 2"))

comp_accuracyvsage_3 <- plot_compaccuracyvsage(filter(study23_overallcomp, study == "Study 3"))

comp_childfigure <- plot_grid(
  comp_accuracyvsage_2 + theme(axis.title.x = element_blank()), 
  comp_accuracyvsage_3, 
  labels = c("A", "B"), ncol = 1, rel_heights = c(3,4)
  )

# print(comp_childfigure)

```

```{r study2-overallcomp-models}
study2_overallcomp <- study23_overallcomp %>% filter(study == "Study 2")

study2_overallcomp$age.years.c <- scale(study2_overallcomp$age, scale = FALSE)

## Doesn't converge but study2_firstprod_either and study2_firstprod_adjacent do?
study2_overallcomp_same <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study2_overallcomp, criteria == "correct"), 
      family = "binomial")

study2_overallcomp_adjacent <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study2_overallcomp, criteria == "correct_nearby"), 
      family = "binomial")
```

```{r study3-overallcomp-models}
study3_overallcomp <- study23_overallcomp %>% filter(study == "Study 3")

study3_overallcomp$age.years.c <- scale(study3_overallcomp$age, scale = FALSE)

study3_overallcomp_same <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study3_overallcomp, criteria == "correct"), 
      family = "binomial")

study3_overallcomp_adjacent <- glmer(score ~ age.years.c  + (age.years.c | prompt) + (1 | subj), 
      data = filter(study3_overallcomp, criteria == "correct_nearby"), 
      family = "binomial")
```

```{r study23-accuracy, fig.cap = "Proportion of accurate responses when applying different accuracy criteria, by age and study. Points show the mean for a 2-year age group (chosen arbitrarily for visualization) with 95% confidence intervals. Lines show a loess smoothing function. Points show the mean for a 2-year age group (chosen arbitrarily for visualization) with 95% confidence intervals."}

study23accuracyplots_prod_plot <- bind_rows(list("Study 2" = study2_adjacentorswitch, 
                 "Study 3" = study3_adjacentorswitch), .id = "study") %>%
  mutate(measure = fct_collapse(measure,
                      "Original" = c("correct"),
                      "Either Language" = c("correcteither"),
                      "Adjacent Color" = c("correctnearby"),
                      "Either + Adjacent" = c("correctall"))) %>%
  mutate(age = floor((age+1)/2)*2-1) %>%
  group_by(study, age, measure) %>% 
  summarise(n = n_distinct(subj),
            ci = qt(0.975, df=n-1)*sd(score)/sqrt(n), 
            score = mean(score), .groups = 'drop') %>%
  ggplot(aes(x = age, y = score, color = measure, group = measure)) +
  facet_grid(. ~ study) +
  geom_point(aes(size = n), alpha = .5,
             position = position_dodge(width = .1)) + 
  geom_linerange(aes(ymin = score - ci, ymax = score + ci), 
                 position = position_dodge(width = .1))+ 
  geom_smooth(span = 2, aes(weight = n), se = FALSE, method = "loess") + 
  labs(x = "Age", y = "Proportion of Responses", 
       fill = "Accuracy", color = "Accuracy", size = "# of Subjects") +
  ggthemes::scale_color_ptol() +
  coord_cartesian(ylim = c(0,1)) + 
  theme_apa() +
  theme(legend.position = "right") 

study23accuracyplots_comp_plot <- study23_overallcomp %>% ungroup() %>%
  mutate(measure = fct_collapse(criteria,
                      "Original" = c("correct"),
                      "Adjacent Color" = c("correct_nearby"))) %>%
  mutate(age = floor((age+1)/2)*2-1) %>%
  group_by(study, age, measure) %>% 
  summarise(n = n_distinct(subj),
            ci = qt(0.975, df=n-1)*sd(score)/sqrt(n), 
            score = mean(score), 
            .groups = 'drop') %>%
  ggplot(aes(x = age, y = score, color = measure, group = measure)) +
  facet_grid(. ~ study) +
  geom_point(aes(size = n), alpha = .5,
             position = position_dodge(width = .1)) + 
  geom_linerange(aes(ymin = score - ci, ymax = score + ci), 
                 position = position_dodge(width = .1))+ 
  geom_smooth(span = 2, aes(weight = n), se = FALSE, method = "loess") + 
  labs(x = "Age", y = "Proportion of Responses", size = "# of Subjects",
       fill = "Accuracy", color = "Accuracy") +
  ggthemes::scale_color_ptol() +
  coord_cartesian(ylim = c(0,1)) + 
  theme_apa() 

study23accuracy_plots <- plot_grid(plot_grid(
  study23accuracyplots_prod_plot + theme(axis.title.x = element_blank()) + theme(legend.position = "none"), 
  study23accuracyplots_comp_plot + theme(legend.position = "none"),
  labels = c("A", "B"), ncol = 1, rel_heights = c(3.5,4), rel_widths = c(1,1)
  ), get_legend(study23accuracyplots_prod_plot), nrow = 1, rel_widths = c(1, 0.2))

print(study23accuracy_plots)


```

```{r study2-task-compare-plot}


study2_task_compare <- study23_firstprod %>%
  bind_rows(study23_overallcomp) %>% 
  filter(study == "Study 2" & 
         spanish %in% c("Amarillo", "Blanco", "Morado", "Negro") &
           criteria == "correct") %>%
  mutate(task = factor(task, levels = c("Production", "Comprehension")),
         prompt = forcats::fct_collapse(spanish,
                    `Joxo - n°274` = c("Blanco"),
                    `Wiso - n°312` = c("Negro"),
                    `Panshin - n°297` = c("Amarillo"),
                    `Ami/Poa - n°325` = c("Morado")))

study2_task_compare  %>%
  group_by(age_interval, task, prompt, spanish) %>%
  summarise(correct = mean(score),
            n = n(),
            .groups = 'drop') %>%
  ggplot(., aes(x = age_interval, y = correct, group = task, fill = task)) +
  geom_col(position = "dodge", width = 0.7, colour="black") + 
  facet_wrap(~ prompt, scales = "free") +
  ggthemes::scale_fill_ptol() +
  scale_x_continuous(limits = c(4.5,11.5), breaks = 5:11) +
  scale_y_continuous(limits = c(-0.1,1.1), breaks = seq(0,1,0.5)) +
  labs(x = "Age", y = "Proportion of Correct Responses", fill = "Task") +
  theme_apa() +
  theme(legend.position = "bottom") 

```


## Results and Discussion

Older children were more accurate in both production and comprehension compared to younger children (Figure \@ref(fig:study23-accuracy)). This produced a significant developmental projection for accuracy of term-chip pairings in both production (`r apa_print(study2_firstprod_same)$statistic$age_years_c`) and comprehension (`r apa_print(study2_overallcomp_same)$statistic$age_years_c`). For some term-chip pairings such as ami/pua and pei/xo, children performed failed to produce the correct term in the production task but improved significantly during the comprehension task (Figure \@ref(fig:study2-task-compare-plot)). It is possible that for children’s color term knowledge, comprehension precedes production. It is also possible that, given that the comprehension task always followed the production task, children were able to pick up on their errors and update their color term mapping in real-time. However, given that the experimenter did not provide feedback on accuracy during sessions, the former explanation seems more likely.


**Language switching**. Over a quarter (`r study2_switchperc$overall_response[1]`%) of all responses were given in Spanish, despite children being prompted solely in SK (i.e., labeling a panshin chip as “amarillo”). The distribution of Spanish responses was non-random, with median use in `r median(study2_overallswitch$n_spanish)`/8 trials (*IQR* = `r paste0(quantile(study2_overallswitch$n_spanish, c(0.25, 0.75)), collapse = "-")`). We failed to find a significant correlation between age and overall Spanish use throughout the production task (`r apa_print(study2_overallswitch_test)$statistic`).

As an exploratory analysis, we attempted to quantify low naming consensus using naming entropy [following @gibson2017]. We computed the naming entropy for each chip by computing the probabilities for each chip $c$ to be named with a particular label $l$ ($p(l \mid c)$) and then taking $H(c) = - \sum{p(l\mid c) \log[p(l \mid c)]}$ (see inset entropy values by chip in Figure \@ref(fig:prod-childfigure)).
To assess the hypothesis that naming entropy in adults was related to Spanish use in children, we fit a mixed effects model predicting  Spanish responses as a function of child age, entropy of the chip's naming distribution for adults in Study 1, and their interaction. Despite age not being significantly correlated with overall frequency of Spanish responses, when added to a mixed-effects model, we found that older children were less likely to respond in Spanish (Table \@ref(tab:study2-accuracyswitchentropy)). Older children were also more likely to respond in Spanish when presented with a chip with high entropy (low naming consensus) among adult participants in Study 1. We found a positive interaction between age and entropy.  

**Overextensions**. One reason to use Spanish would be if children fail to recall the proper SK color term but do know the proper mapping in the Spanish. But another possibility is that children may have more imprecise representations and choose to respond with a same-language but adjacent color term (i.e., labeling a *panshin*-colored chip as “joshin”). Following @wagner2013, we aggregated across color chips and examine the pattern of children's first responses, categorizing them as same-language, adjacent, and different-language. Using a mixed-effects model, we found that younger children were more likely to respond with SK-language but adjacent terms (`r apa_print(study2_AdjacEnt_model)$estimate$age_years_c`)  but chip entropy did not have a significant factor in this strategy (`r apa_print(study2_AdjacEnt_model)$estimate$Entropy`). 

If children fail to recall the proper color term in SK, but do know the proper mapping in the Spanish color system, language-switching may be an appropriate strategy. Should they lack knowledge of the corresponding Spanish color term, they may also choose to respond with a same-language but adjacent color term. If we allow for more leniency in scoring--accepting same-language but adjacent or different-language but corresponding responses--we can check for more subtlety surrounding color term mapping (Figure \@ref(fig:study23-accuracy)). Using a mixed-effects model, we found a significant improvement in accuracy scores when we allowed different-language but corresponding responses (`r apa_print(study2_firstprod_all)$statistic$criteriacorrect_either`) but no significant change when allowing for same-language but adjacent responses (`r apa_print(study2_firstprod_all)$statistic$criteriacorrect_nearby`). This increase in accuracy with language-switching strengthened with age (`r apa_print(study2_firstprod_all)$statistic$age_years_c_criteriacorrect_either`). 


# Study 3

Noting the apparent strategy of language switching seen in Study 2, we designed Study 3 as its complement. Here, we tested children’s production and comprehension of Spanish color terms with a similar protocol to Study 2, albeit with a subset of chips representing prototypical colors for the Spanish color system. 

**Participants**. Similar to Study 2, `r study3_participants$num_total` children (`r study3_participants$num_boys` boys) ages `r study3_participants$min_age`- to `r study3_participants$max_age`-years-old were recruited from the neighborhood of Bena Jema in Yarinacocha and from Bawanisho. Recruitment occurred either through interested parents or a local school. With consent collected from parents and, if in a school environment, teachers as well.


**Materials and procedure**. Based on Study 1 and on previous studies of Spanish color systems (XXX et al), we selected 11 color chips to serve as prototypical instances of prominent Peruvian Spanish color terms. These color chips included 6 also used during Study 2: green (n°234), red (n°245), white (n°274), yellow (n°297),  black (n°312) , and purple (n°325). Five additional chips were selected: gray (WCS n°46), pink (n°65), orange (n°121), brown (n°266), and blue (n°291) (see Appendix 1). The blue chips differed between Studies 2 and 3 as we decided that the prototypical hues for *yankon* and *azul* differed enough to warrant the use of a different chip.

As SK children are not very fluent in Spanish (formal Spanish education occurs in adolescence), the production and comprehension tasks were both conducted in SK, and Spanish was only used for color terms (i.e., Spanish color terms were embedded within otherwise SK sentences). In both tasks, a participant would sit at a table across from the experimenter with 11 color chips in front. As in Study 2, the production task was always performed prior to the comprehension task.

**Production task**. The procedure was similar to that of both Studies 1 and 2. The experimenter would introduce a participant to the general procedure and aims of the study. Despite much of the study being conducted in SK, the experimenter would specify that participants would be expected to provide color terms in Spanish. The experimenter would then ask: “What is the color of this chip?”. If the participant responded in SK, the experimenter would record their response but further ask: “What is the name of this color in Spanish?”. If a participant responded with “I don’t know” to this prompt, the experimenter would not prompt any further and would move forward to the next chip. As a result, some responses lack Spanish-language BCTs and only consist of non-basic and/or SK color terms. In total, we collected production data for 11 color chips. For each chip, the data include either one response (when children provided a Spanish basic color term in the first trial) or two or three responses (when children’s initial responses were either non-basic and/or in SK).

**Comprehension task**. The procedure was similar to that of Study 2. The experimenter would ask: Can you give me the [*color term*] chip? For 11 Spanish color terms. The choice of these terms was based on both previous studies examining Spanish color terms as well as responses given by adult participants in Study 1 (as some adult participants used Spanish color terms to label particular color chips). The 11 terms used as prompts were *blanco* (“white”), *verde* (“green”), *rojo* (“red”), *amarillo* (“yellow”), *azul* (“blue”), *negro* (“black”), *naranja* (“orange”), *gris* (“grey”), *morado* (“purple”), *marrón* (“brown”), and *rosa* (“pink”). Since each color term was best instantiated by a single color chip and lacked the ambiguity seen with certain SK color terms, accuracy was graded one-to-one for term-chip pairings with less leniency compared to Study 2.

## Results and Discussion

Contrasting Study 2, we found age to be a significant predictor of accuracy in the comprehension task (`r apa_print(study3_overallcomp_same)$statistic$age_years_c`), but not in the production task (`r apa_print(study3_firstprod_same)$statistic$age_years_c`, see Figure \@ref(fig:study23-accuracy)). Similar to Study 2, over a quarter (`r study3_switchperc$overall_response[1]`%) of all responses were given in SK, despite being prompted to respond in Spanish. There was significant variation in language-switching with some children responding solely in Spanish while others responded to upwards of `r max(study3_overallswitch$n_shipibo)`/11 trials in SK (*Mdn* = `r median(study3_overallswitch$n_shipibo)` trials, *IQR* = `r paste0(quantile(study3_overallswitch$n_shipibo, c(0.25, 0.75)), collapse = "-")`). We found only a marginal correlation between age and label accuracy (`r apa_print(study3_overallscore_test)$statistic`) and an insignificant correlation between age and language-switching (`r apa_print(study3_overallswitch_test)$statistic`). Still, when accounting for age, we found that participants tended to respond in SK when presented with items that had low entropy in Study 1 (`r apa_print(study3_SwitchEnt_model)$statistic$Entropy`). This suggests that child participants across Studies 2 and 3 preferred to respond in SK when presented with a high-consensus chip, and in Spanish with a low-consensus chip.

Similar to Study 2, we adopted alternative scoring to accommodate language-switching from Spanish to SK (different-language) but corresponding and same-language but adjacent responses. Using a mixed-effects model, we failed to find age as a significant predictor for accuracy even with this more lenient scoring (`r apa_print(study3_firstprod_all)$statistic$age_years_c`), in concordance with earlier analyses. However, we did find that participants improved accuracy through both mapping strategies of either providing different-language but corresponding responses (`r apa_print(study3_firstprod_all)$statistic$criteriacorrect_either`) or same-language but adjacent responses (`r apa_print(study3_firstprod_all)$statistic$criteriacorrect_nearby`). We find frequent use of language switching in both Studies 2 and 3, but only Study 3 exhibits significant use of same-language but adjacent terms. 

It is possible that early but informal Spanish language exposure can explain the discrepancies seen in Studies 2 and 3. Children may be exposed to Spanish at a young age but likely do not receive any formal Spanish education until adolescence. With limited knowledge of Spanish color terms, children may spontaneously supplement their color term knowledge with Spanish terms during SK-language Study 2 but struggle to succeed during Spanish-language Study 3. More generally, we see children relying on a mixture of strategies to communicate colors even in the absence of mastery in either language. 


# General Discussion

TO BE PASTED FROM GOOGLE DOC

Summary of study. 
Adult data - bilingualism and relation to WCS data
When we turned to the children’s data, two important generalizations emerged. First, we observed a much longer developmental trajectory for color than is observed in modern US populations (cf. Bornstein, 1985). 
Second, we found evidence for competition between the Shipibo and Spanish color systems, implying the potential for functionally-driven language change. 
Gibson analysis of optimality: children use spanish words for low-consensus chips, SK words for high consensus chips. These support the optimality hypothesis
Limitations of our work. 
	Cross-sectional
	Limited number of chips for kids (limits entropy analyses)
	
In sum, these data further support a model of color word knowledge and acquisition that is driven by communicative need. 
Need for more developmental work on other languages. 
Huge role for environmental input


\newpage

# References

```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
